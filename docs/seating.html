<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>å©šå®´åº§ä½å®‰æ’ v13ï¼ˆA3 æ‰“å°ç‰ˆ + ç´ é£Ÿæ¨™è¨˜ + å¸¶ä½è¡¨ï¼‰</title>
<style>
  :root{
    --bg: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    --card:#ffffff;
    --line:#e5e7eb;
    --text:#111827;
    --muted:#6b7280;
    --primary: #667eea;
    --primary-dark: #5568d3;
    --success: #10b981;
    --warning: #f59e0b;
    --danger: #ef4444;
    --shadow: 0 20px 25px -5px rgba(0, 0, 0, .1), 0 10px 10px -5px rgba(0, 0, 0, .04);
    --shadow-lg: 0 25px 50px -12px rgba(0, 0, 0, .25);
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans TC", sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* Header */
  header {
    background: rgba(255, 255, 255, 0.98);
    backdrop-filter: blur(10px);
    padding: 16px 24px;
    border-bottom: 1px solid var(--line);
    position: sticky;
    top: 0;
    z-index: 100;
    box-shadow: var(--shadow);
  }

  .header-content {
    max-width: 1600px;
    margin: 0 auto;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 12px;
  }

  header h1 {
    font-size: 24px;
    font-weight: 900;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .stats-bar {
    display: flex;
    gap: 16px;
    flex-wrap: wrap;
  }

  .stat-item {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 16px;
    background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
    border-radius: 12px;
    font-size: 14px;
    font-weight: 600;
  }

  .stat-number {
    font-size: 18px;
    font-weight: 900;
    color: var(--primary);
  }

  /* Layout */
  .container {
    max-width: 1600px;
    margin: 0 auto;
    padding: 24px;
  }

  .layout {
    display: grid;
    grid-template-columns: 380px 1fr;
    gap: 24px;
    align-items: start;
  }

  @media (max-width: 1024px) {
    .layout { grid-template-columns: 1fr; }
  }

  /* Panel */
  .panel {
    background: white;
    border-radius: 20px;
    box-shadow: var(--shadow-lg);
    overflow: hidden;
    position: sticky;
    top: 100px;
    max-height: calc(100vh - 120px);
    display: flex;
    flex-direction: column;
  }

  @media (max-width: 1024px) {
    .panel {
      position: relative;
      top: auto;
      max-height: none;
    }
  }

  .panel-header {
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    color: white;
    padding: 20px;
  }

  .panel-header h2 {
    font-size: 18px;
    font-weight: 800;
    margin-bottom: 4px;
  }

  .panel-header .subtitle {
    font-size: 13px;
    opacity: 0.9;
  }

  .panel-body {
    padding: 20px;
    overflow-y: auto;
    flex: 1;
  }

  .panel-section {
    margin-bottom: 24px;
  }

  .section-title {
    font-size: 14px;
    font-weight: 700;
    margin-bottom: 12px;
    color: var(--text);
    display: flex;
    align-items: center;
    gap: 8px;
  }

  /* Search */
  .search-box {
    position: relative;
    margin-bottom: 16px;
  }

  .search-box input {
    width: 100%;
    padding: 12px 16px 12px 40px;
    border: 2px solid var(--line);
    border-radius: 12px;
    font-size: 14px;
    transition: all 0.3s ease;
  }

  .search-box input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
  }

  .search-icon {
    position: absolute;
    left: 14px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--muted);
    font-size: 16px;
  }

  /* Guest Chips */
  .chips {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    max-height: 320px;
    overflow-y: auto;
    padding: 4px;
  }

  .chip {
    background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
    border: 2px solid var(--line);
    border-radius: 999px;
    padding: 8px 14px;
    font-size: 13px;
    font-weight: 600;
    cursor: grab;
    user-select: none;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .chip:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    border-color: var(--primary);
  }

  .chip:active {
    cursor: grabbing;
    transform: scale(0.98);
  }

  .chip.selected {
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    color: white;
    border-color: var(--primary);
  }

  .chip-badge {
    background: rgba(255, 255, 255, 0.3);
    padding: 2px 8px;
    border-radius: 999px;
    font-size: 11px;
  }

  /* Buttons */
  .btn {
    padding: 10px 16px;
    border: none;
    border-radius: 10px;
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    display: inline-flex;
    align-items: center;
    gap: 6px;
  }

  .btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }

  .btn:active {
    transform: translateY(0);
  }

  .btn-primary {
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    color: white;
  }

  .btn-secondary {
    background: white;
    color: var(--text);
    border: 2px solid var(--line);
  }

  .btn-danger {
    background: var(--danger);
    color: white;
  }

  .btn-warning {
    background: var(--warning);
    color: white;
  }

  .btn-group {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
  }

  /* Quick Actions */
  .quick-actions {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 8px;
    margin-bottom: 16px;
  }

  .quick-action-btn {
    padding: 12px;
    background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
    border: 2px solid var(--line);
    border-radius: 12px;
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    text-align: center;
  }

  .quick-action-btn:hover {
    background: var(--primary);
    color: white;
    border-color: var(--primary);
    transform: scale(1.05);
  }

  .quick-action-btn.save-default {
    background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%);
    border-color: var(--success);
    color: #15803d;
    font-weight: 700;
  }

  .quick-action-btn.save-default:hover {
    background: var(--success);
    color: white;
  }

  /* Textarea */
  textarea {
    width: 100%;
    padding: 12px;
    border: 2px solid var(--line);
    border-radius: 12px;
    font-size: 13px;
    resize: vertical;
    min-height: 120px;
    font-family: inherit;
  }

  textarea:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
  }

  /* Plan Panel */
  .plan-panel {
    background: white;
    border-radius: 20px;
    box-shadow: var(--shadow-lg);
    overflow: hidden;
  }

  .plan-header {
    padding: 20px;
    border-bottom: 1px solid var(--line);
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 12px;
  }

  .plan-header h2 {
    font-size: 18px;
    font-weight: 800;
  }

  .toolbar {
    display: flex;
    gap: 8px;
    align-items: center;
    flex-wrap: wrap;
  }

  .zoom-badge {
    padding: 6px 12px;
    background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
    border-radius: 999px;
    font-size: 12px;
    font-weight: 700;
    color: var(--primary);
  }

  .plan-viewport {
    height: calc(100vh - 250px);
    min-height: 600px;
    overflow: auto;
    background: #fafafa;
  }

  @media (max-width: 1024px) {
    .plan-viewport { height: 70vh; }
  }

  .plan {
    position: relative;
    width: 1700px;
    height: 2400px;
    margin: 0;
    transform-origin: 0 0;
    background:
      linear-gradient(to right, rgba(229, 231, 235, 0.5) 1px, transparent 1px) 0 0/50px 50px,
      linear-gradient(to bottom, rgba(229, 231, 235, 0.5) 1px, transparent 1px) 0 0/50px 50px,
      radial-gradient(circle at 20% 10%, rgba(102, 126, 234, 0.03), transparent 40%),
      radial-gradient(circle at 80% 90%, rgba(118, 75, 162, 0.03), transparent 40%),
      #ffffff;
  }

  @media print {
    @page {
      size: A3 portrait;
      margin: 10mm;
    }

    body {
      background: white;
    }

    header, .panel {
      display: none !important;
    }

    .plan-panel {
      box-shadow: none;
      border-radius: 0;
    }

    .plan-header {
      border-bottom: 2px solid #000;
      padding: 10px 0;
    }

    .plan-viewport {
      height: auto !important;
      overflow: visible !important;
    }

    .plan {
      transform: none !important;
    }
  }

  /* Zone */
  .zone {
    position: absolute;
    border: 3px dashed var(--line);
    border-radius: 20px;
    background: rgba(243, 244, 246, 0.6);
    backdrop-filter: blur(4px);
    color: var(--muted);
    font-size: 18px;
    font-weight: 700;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: 16px;
    z-index: 1;
  }

  /* Table */
  .tableWrap {
    position: absolute;
    transform: translate(-50%, -50%);
    pointer-events: auto;
    z-index: 3;
  }

  .table {
    position: relative;
    width: 100%;
    height: 100%;
  }

  .center {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: linear-gradient(135deg, #ffffff 0%, #f9fafb 100%);
    border-radius: 999px;
    border: 3px solid var(--primary);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    gap: 6px;
    box-shadow: 0 10px 25px rgba(102, 126, 234, 0.2);
    cursor: pointer;
    padding: 12px;
    transition: all 0.3s ease;
  }

  .center:hover {
    transform: translate(-50%, -50%) scale(1.1);
    box-shadow: 0 15px 35px rgba(102, 126, 234, 0.3);
  }

  .center strong {
    font-size: 22px;
    font-weight: 900;
    color: var(--primary);
  }

  .groupTag {
    font-size: 14px;
    font-weight: 700;
    color: white;
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    border-radius: 999px;
    padding: 6px 14px;
    max-width: 160px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .center .count {
    font-size: 16px;
    font-weight: 700;
    color: var(--success);
  }

  .tableNumber {
    position: absolute;
    top: -55px;
    left: 50%;
    transform: translateX(-50%);
    width: 50px;
    height: 50px;
    border-radius: 999px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 22px;
    font-weight: 900;
    border: 4px solid white;
    z-index: 10;
    color: white;
  }

  /* Seat */
  .seat {
    position: absolute;
    border-radius: 999px;
    padding: 0 16px;
    background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
    border: 3px solid var(--line);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
    font-weight: 700;
    cursor: pointer;
    user-select: none;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    transition: all 0.2s ease;
  }

  .seat:hover {
    transform: scale(1.15);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
    z-index: 10;
  }

  .seat.filled {
    background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
    border-color: #fbbf24;
    color: #92400e;
  }

  .seat.dragover {
    outline: 3px dashed var(--primary);
    outline-offset: 4px;
    background: rgba(102, 126, 234, 0.1);
  }

  .seat.child {
    padding: 0;
    font-size: 14px;
    font-weight: 700;
  }

  .seat.child.filled {
    background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
    border-color: #60a5fa;
    color: #1e40af;
  }

  .seat.vegetarian {
    position: relative;
    overflow: visible;
  }

  .seat.vegetarian::before {
    content: "ğŸ¥¬";
    position: absolute;
    top: -10px;
    right: -10px;
    font-size: 18px;
    background: white;
    border-radius: 999px;
    width: 26px;
    height: 26px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    z-index: 100;
    pointer-events: none;
  }

  /* Hint */
  .hint {
    font-size: 12px;
    color: var(--muted);
    line-height: 1.6;
    padding: 12px;
    background: #f9fafb;
    border-radius: 10px;
    border-left: 4px solid var(--primary);
  }

  /* Help Box */
  .help-box {
    background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
    border: 2px solid #fbbf24;
    border-radius: 12px;
    padding: 16px;
    margin-bottom: 16px;
  }

  .help-box h4 {
    font-size: 14px;
    font-weight: 800;
    margin-bottom: 8px;
    color: #92400e;
  }

  .help-box p {
    font-size: 12px;
    line-height: 1.6;
    color: #78350f;
    margin-bottom: 8px;
  }

  .help-box pre {
    background: white;
    border: 1px solid #fbbf24;
    border-radius: 8px;
    padding: 12px;
    font-size: 11px;
    overflow-x: auto;
    margin-top: 8px;
    color: #1f2937;
  }

  .help-box code {
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
  }

  .help-toggle {
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px;
    background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
    border: 2px solid #60a5fa;
    border-radius: 12px;
    margin-bottom: 12px;
    font-size: 13px;
    font-weight: 700;
    color: #1e40af;
  }

  .help-toggle:hover {
    background: linear-gradient(135deg, #bfdbfe 0%, #93c5fd 100%);
  }

  .help-content {
    display: none;
  }

  .help-content.show {
    display: block;
  }

  /* Info Badge */
  .info-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 8px 12px;
    background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%);
    border: 2px solid var(--success);
    border-radius: 999px;
    font-size: 11px;
    font-weight: 700;
    color: #15803d;
    margin-bottom: 12px;
  }

  /* Legend */
  .legend {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    padding: 16px;
    background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
    border-radius: 12px;
    margin-bottom: 16px;
  }

  .legend-item {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 13px;
    font-weight: 600;
  }

  .legend-badge {
    width: 28px;
    height: 28px;
    border-radius: 999px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    font-weight: 900;
    color: white;
    border: 2px solid white;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
  }

  /* Scrollbar */
  ::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }

  ::-webkit-scrollbar-track {
    background: #f3f4f6;
    border-radius: 10px;
  }

  ::-webkit-scrollbar-thumb {
    background: #d1d5db;
    border-radius: 10px;
  }

  ::-webkit-scrollbar-thumb:hover {
    background: #9ca3af;
  }
</style>
    <style>
        .back-to-home {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, #d4145a 0%, #ff5a8a 100%);
            color: white;
            padding: 12px 24px;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 600;
            font-size: 14px;
            box-shadow: 0 4px 16px rgba(212, 20, 90, 0.3);
            transition: all 0.3s ease;
            z-index: 9999;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .back-to-home:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(212, 20, 90, 0.4);
        }
        @media print {
            .back-to-home { display: none; }
        }
        @media (max-width: 768px) {
            .back-to-home {
                bottom: 16px;
                right: 16px;
                padding: 10px 20px;
                font-size: 13px;
            }
        }
    </style>
</head>

<body>
    <a href="index.html" class="back-to-home">
        <span>ğŸ </span>
        <span>è¿”å›é¦–é </span>
    </a>
<header>
  <div class="header-content">
    <div>
      <h1>ğŸ’’ å©šå®´åº§ä½å®‰æ’ç³»çµ± v13ï¼ˆA3 æ‰“å°ç‰ˆï¼‰</h1>
    </div>
    <div class="stats-bar">
      <div class="stat-item">
        <span>ğŸª‘ ç¸½åº§ä½</span>
        <span class="stat-number" id="totalSeats">0</span>
      </div>
      <div class="stat-item">
        <span>âœ… å·²å®‰æ’</span>
        <span class="stat-number" id="assignedCount">0</span>
      </div>
      <div class="stat-item">
        <span>â³ å¾…å®‰æ’</span>
        <span class="stat-number" id="unassignedCount">0</span>
      </div>
      <div class="stat-item">
        <span>ğŸ‘¶ å…’ç«¥åº§æ¤…</span>
        <span class="stat-number" id="childSeatsCount">0</span>
      </div>
      <div class="stat-item">
        <span>ğŸ¥¬ ç´ é£Ÿ</span>
        <span class="stat-number" id="vegetarianCount">0</span>
      </div>
      <div class="stat-item" style="background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);">
        <span>ğŸ‘” ç”·æ–¹</span>
        <span class="stat-number" id="groomSideCount" style="color: #1e40af;">0</span>
      </div>
      <div class="stat-item" style="background: linear-gradient(135deg, #fce7f3 0%, #fbcfe8 100%);">
        <span>ğŸ‘° å¥³æ–¹</span>
        <span class="stat-number" id="brideSideCount" style="color: #be185d;">0</span>
      </div>
    </div>
  </div>
</header>

<div class="container">
  <div class="layout">
    <!-- Left Panel -->
    <section class="panel">
      <div class="panel-header">
        <h2>è³“å®¢ç®¡ç†</h2>
        <div class="subtitle">æ‹–æ›³æˆ–é»æ“Šæ“ä½œï¼Œè³‡æ–™è‡ªå‹•ä¿å­˜</div>
      </div>

      <div class="panel-body">
        <!-- Preset State Info -->
        <div id="defaultStateInfo" class="info-badge" style="display: none;">
          <span>âœ¨</span>
          <span id="defaultStateText">ä½¿ç”¨ä¸­ï¼šå·²ä¿å­˜çš„é è¨­å€¼</span>
        </div>

        <!-- Legend -->
        <div class="legend">
          <div class="legend-item">
            <div class="legend-badge" style="background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);">1</div>
            <span>ä¸»æ¡Œ (1)</span>
          </div>
          <div class="legend-item">
            <div class="legend-badge" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);">2</div>
            <span>ç”·æ–¹æ¡Œ (2-6)</span>
          </div>
          <div class="legend-item">
            <div class="legend-badge" style="background: linear-gradient(135deg, #ec4899 0%, #db2777 100%);">7</div>
            <span>å¥³æ–¹æ¡Œ (7-15)</span>
          </div>
        </div>

        <!-- Help Toggle -->
        <div class="help-toggle" onclick="toggleHelp()">
          <span>ğŸ“– ä½¿ç”¨èªªæ˜ & JSON æ ¼å¼ç¯„ä¾‹</span>
          <span id="helpArrow">â–¼</span>
        </div>

        <div id="helpContent" class="help-content">
          <div class="help-box">
            <h4>ğŸ“ JSON æ ¼å¼èªªæ˜</h4>
            <p><strong>æ–¹æ³•ä¸€ï¼šå®Œæ•´å‚™ä»½ JSON</strong></p>
            <p>é»æ“Šã€ŒğŸ’¾ åŒ¯å‡ºå‚™ä»½ã€æœƒè¤‡è£½å®Œæ•´ JSONï¼ŒåŒ…å«æ‰€æœ‰åº§ä½èˆ‡æ¡Œåˆ¥è³‡è¨Šã€‚åŒ¯å…¥æ™‚ä½¿ç”¨ã€ŒåŒ¯å…¥JSONã€æŒ‰éˆ•ã€‚</p>

            <p style="margin-top: 12px;"><strong>æ–¹æ³•äºŒï¼šèˆŠæ ¼å¼ JSON (table_no/seat_no)</strong></p>
            <p>å¦‚æœä½ æœ‰èˆŠçš„ table_no/seat_no æ ¼å¼ï¼Œä½¿ç”¨ã€ŒåŒ¯å…¥èˆŠæ ¼å¼ã€æŒ‰éˆ•ã€‚ç¯„ä¾‹æ ¼å¼ï¼š</p>
            <pre><code>{
  "tables": [
    {
      "table_no": 1,
      "seats": [
        {"seat_no": 1, "name": "ç‹å°æ˜"},
        {"seat_no": 2, "name": "æå°è¯"},
        {"seat_no": 3, "name": "ç©ºä½"}
      ]
    }
  ]
}</code></pre>

            <p style="margin-top: 12px;"><strong>ğŸ’¾ ä¿å­˜ç‚ºé è¨­å€¼</strong></p>
            <p>â€¢ é»æ“Šã€ŒğŸ’¾ ä¿å­˜ç‚ºé è¨­å€¼ã€å¯å°‡ç•¶å‰åº§ä½åˆ†é…ä¿å­˜</p>
            <p>â€¢ ä¸‹æ¬¡æ‰“é–‹æª”æ¡ˆæ™‚æœƒè‡ªå‹•è¼‰å…¥ä¿å­˜çš„åº§ä½åˆ†é…</p>
            <p>â€¢ é»æ“Šã€ŒğŸ”„ æ¢å¾©é è¨­å€¼ã€å¯æ¢å¾©åˆ°æ‚¨ä¿å­˜çš„é è¨­å€¼ï¼ˆå¦‚æœæ²’æœ‰ä¿å­˜éï¼Œå‰‡æ¢å¾©åˆ°ç³»çµ±åŸå§‹é è¨­å€¼ï¼‰</p>

            <p style="margin-top: 12px;"><strong>ğŸ“‹ v13 æ–°åŠŸèƒ½ï¼šå¸¶ä½è¡¨æ ¼</strong></p>
            <p>â€¢ é»æ“Šã€Œç”·æ–¹å¸¶ä½è¡¨ã€æˆ–ã€Œå¥³æ–¹å¸¶ä½è¡¨ã€æŒ‰éˆ•</p>
            <p>â€¢ è‡ªå‹•ç”Ÿæˆåˆ†é¡å¸¶ä½è¡¨æ ¼ï¼Œé¡¯ç¤ºæ¡Œè™Ÿã€æ¡Œåå’Œè³“å®¢åå–®</p>
            <p>â€¢ è¡¨æ ¼åŒ…å«å‹¾é¸æ¡†ï¼Œæ–¹ä¾¿å¸¶ä½äººå“¡ä½¿ç”¨</p>
            <p>â€¢ å¯ç›´æ¥åˆ—å°ï¼Œé©åˆç¾å ´å¸¶ä½ä½¿ç”¨</p>

            <p style="margin-top: 12px;"><strong>ğŸ¥¬ v12 æ–°åŠŸèƒ½ï¼šç´ é£Ÿæ¨™è¨˜</strong></p>
            <p>â€¢ åœ¨å·²å®‰æ’çš„åº§ä½ä¸Šå³éµé»æ“Šå¯åˆ‡æ›ç´ é£Ÿæ¨™è¨˜</p>
            <p>â€¢ ç´ é£Ÿè³“å®¢æœƒåœ¨åº§ä½å³ä¸Šè§’é¡¯ç¤º ğŸ¥¬ åœ–æ¨™</p>
            <p>â€¢ çµ±è¨ˆå€æœƒé¡¯ç¤ºå…’ç«¥åº§æ¤…æ•¸é‡å’Œç´ é£Ÿäººæ•¸</p>
            <p>â€¢ æ–¹ä¾¿é¤å»³å‚™é¤å’Œå¸¶ä½äººå“¡è­˜åˆ¥</p>

            <p style="margin-top: 12px;"><strong>ğŸ†• v11 æ”¹é€²ï¼š</strong></p>
            <p>â€¢ é è¨­å€¼ä¸æœƒè¢«æ„å¤–æ¸…é™¤ï¼Œæ›´åŠ å®‰å…¨</p>
            <p>â€¢ æœªå®‰æ’è³“å®¢å¯ä»¥ä¸€éµæ¸…ç©º</p>
            <p>â€¢ åå–®æ“ä½œèªªæ˜æ›´æ¸…æ™°</p>

            <p style="margin-top: 12px;"><strong>ğŸ¨ v9 æ–°åŠŸèƒ½ï¼šå½©è‰²æ¡Œè™Ÿ</strong></p>
            <p>â€¢ ä¸»æ¡Œï¼šé‡‘è‰²ç·¨è™Ÿ 1</p>
            <p>â€¢ ç”·æ–¹æ¡Œ (3-1, 3-2, 5-1, 3-3, 5-2)ï¼šè—è‰²ç·¨è™Ÿ 2-6</p>
            <p>â€¢ å¥³æ–¹æ¡Œ (å…¶ä»–9æ¡Œ)ï¼šç²‰ç´…è‰²ç·¨è™Ÿ 7-15</p>
            <p>â€¢ æ¡Œè™Ÿä½æ–¼æ¡Œå­ä¸Šæ–¹ï¼Œæ¸…æ™°æ˜“è¦‹</p>

            <p style="margin-top: 12px;"><strong>ğŸ–¨ï¸ v10 æ–°åŠŸèƒ½ï¼šA3 æ‰“å°å„ªåŒ–</strong></p>
            <p>â€¢ å„ªåŒ–ç‚º A3 æ©«å‘å°ºå¯¸ï¼ˆ420mm Ã— 297mmï¼‰</p>
            <p>â€¢ æ‰€æœ‰å­—é«”æ”¾å¤§ï¼Œæ–¹ä¾¿å¸¶ä½äººå“¡æŸ¥çœ‹</p>
            <p>â€¢ æ¡Œè™Ÿã€æ¡Œåã€åº§ä½åå­—ç­‰é—œéµè³‡è¨Šæ¸…æ™°å¯è®€</p>
            <p>â€¢ ä½¿ç”¨ç€è¦½å™¨åˆ—å°åŠŸèƒ½å¯ç›´æ¥è¼¸å‡º A3 å°ºå¯¸</p>
          </div>
        </div>

        <!-- Search -->
        <div class="panel-section">
          <div class="search-box">
            <span class="search-icon">ğŸ”</span>
            <input id="search" type="text" placeholder="å¿«é€Ÿæœå°‹è³“å®¢å§“å..." />
          </div>
        </div>

        <!-- Quick Actions -->
        <div class="panel-section">
          <div class="section-title">âš¡ å¿«é€Ÿæ“ä½œ</div>
          <div class="quick-actions">
            <button class="quick-action-btn" id="importQuickBtn">ğŸ“¥ åŒ¯å…¥åå–®</button>
            <button class="quick-action-btn" id="exportQuickBtn">ğŸ’¾ åŒ¯å‡ºå‚™ä»½</button>
            <button class="quick-action-btn save-default" id="saveDefaultBtn">ğŸ’¾ ä¿å­˜ç‚ºé è¨­å€¼</button>
            <button class="quick-action-btn" id="clearAllBtn">ğŸ—‘ï¸ æ¸…ç©ºåº§ä½</button>
            <button class="quick-action-btn" id="exportPngQuickBtn">ğŸ“· ä¸‹è¼‰åœ–ç‰‡</button>
            <button class="quick-action-btn" id="restorePresetBtn">ğŸ”„ æ¢å¾©é è¨­å€¼</button>
          </div>
        </div>

        <!-- Seating Guide Tables -->
        <div class="panel-section">
          <div class="section-title">ğŸ“‹ å¸¶ä½è¡¨æ ¼</div>
          <div class="quick-actions">
            <button class="quick-action-btn" id="exportGroomGuideBtn" style="background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); border-color: #3b82f6; color: #1e40af;">ğŸ‘” ç”·æ–¹å¸¶ä½è¡¨</button>
            <button class="quick-action-btn" id="exportBrideGuideBtn" style="background: linear-gradient(135deg, #fce7f3 0%, #fbcfe8 100%); border-color: #ec4899; color: #9f1239;">ğŸ‘° å¥³æ–¹å¸¶ä½è¡¨</button>
          </div>
        </div>

        <!-- Table Reference -->
        <div class="panel-section">
          <div class="section-title">ğŸ’ å©šç¦®è³‡è¨Š</div>
          <div class="quick-actions">
            <button class="quick-action-btn" id="showTableNamesBtn" style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border-color: #fbbf24; color: #92400e;">ğŸ’• æ¡Œåå°æ‡‰è¡¨</button>
            <button class="quick-action-btn" id="showFloorPlanBtn" style="background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%); border-color: #6366f1; color: #3730a3;">ğŸ›ï¸ å ´åœ°å¹³é¢åœ–</button>
          </div>
        </div>

        <!-- Guest List -->
        <div class="panel-section">
          <div class="section-title" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
            <div>
              ğŸ‘¥ æœªå®‰æ’è³“å®¢
              <span id="poolCount" style="color: var(--muted); font-weight: 600;"></span>
            </div>
            <button class="btn btn-danger" id="clearPoolBtn" style="padding: 6px 12px; font-size: 12px;">ğŸ—‘ï¸ æ¸…ç©º</button>
          </div>
          <div class="hint" style="margin-bottom: 12px;">
            ğŸ’¡ <strong>æ“ä½œæç¤º:</strong> æ‹–æ›³è³“å®¢åˆ°åº§ä½ï¼Œæˆ–é»é¸è³“å®¢â†’é»åº§ä½ã€‚å·²å®‰æ’çš„åº§ä½å¯é»æ“Šå–æ¶ˆã€‚<strong>å³éµé»æ“Šåº§ä½å¯åˆ‡æ›ç´ é£Ÿæ¨™è¨˜ ğŸ¥¬</strong>
          </div>
          <div class="chips" id="pool"></div>
        </div>

        <!-- Import/Export -->
        <div class="panel-section">
          <div class="section-title">ğŸ“ æ‰¹é‡ç·¨è¼¯åå–®</div>
          <div class="hint" style="margin-bottom: 12px;">
            ğŸ’¡ åœ¨ä¸‹æ–¹è¼¸å…¥è³“å®¢å§“åï¼Œé»æ“Šã€Œåˆä½µåˆ°æœªå®‰æ’ã€æœƒå°‡æ–°åå–®åŠ å…¥æœªå®‰æ’è³“å®¢å€ï¼ˆä¸æœƒå½±éŸ¿å·²å®‰æ’çš„åº§ä½ï¼‰
          </div>
          <textarea id="importBox" placeholder="è²¼ä¸Šè³“å®¢åå–®ï¼Œä¸€è¡Œä¸€å€‹å§“åï¼Œæˆ–ç”¨ç©ºç™½åˆ†é–‹...&#10;ä¾‹å¦‚ï¼š&#10;ç‹å°æ˜&#10;æå°è¯&#10;å¼µä¸‰ æå›› ç‹äº”"></textarea>
          <div class="btn-group" style="margin-top: 12px;">
            <button class="btn btn-primary" id="importBtn">ğŸ“¥ åˆä½µåˆ°æœªå®‰æ’</button>
            <button class="btn btn-secondary" id="importJsonBtn">åŒ¯å…¥JSON</button>
            <button class="btn btn-secondary" id="importLegacyBtn">åŒ¯å…¥èˆŠæ ¼å¼</button>
          </div>
        </div>
      </div>
    </section>

    <!-- Right Plan -->
    <section class="plan-panel">
      <div class="plan-header">
        <h2>ğŸ—ºï¸ å¹³é¢é…ç½®åœ–ï¼ˆ15æ¡Œï¼Œæ¯æ¡Œ12äººï¼‰</h2>
        <div class="toolbar">
          <span class="zoom-badge" id="zoomBadge">100%</span>
          <button class="btn btn-secondary" id="zoomIn">â•</button>
          <button class="btn btn-secondary" id="zoomOut">â–</button>
          <button class="btn btn-secondary" id="zoomReset">é‡è¨­</button>
          <button class="btn btn-primary" id="exportPngBtn">ğŸ“· ä¸‹è¼‰åœ–ç‰‡</button>
        </div>
      </div>

      <div class="plan-viewport" id="planViewport">
        <div class="plan" id="plan"></div>
      </div>
    </section>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<script>
/** =========================
 *  è¨­å®š - æ‰€æœ‰æ¡Œå­çµ±ä¸€ç‚º12äºº
 * ========================= */
const TABLE_SEATS = 12;
function seatCountByIndex(ti) {
  return TABLE_SEATS;
}

const ADULT_SEAT = { w: 110, h: 32 };
const CHILD_SEAT = { w: 46, h: 46 };

const STORAGE_KEY = "wedding_floorplan_v13_current";
const SAVED_DEFAULT_KEY = "wedding_floorplan_v13_saved_preset";
const defaultGuestText = "";

function toSeatObj(v) {
  if (v == null) return { kind: "adult", name: null, parentSurname: "", isVegetarian: false };
  if (typeof v === "string") return { kind: "adult", name: v, parentSurname: "", isVegetarian: false };
  if (typeof v === "object") {
    return {
      kind: (v.kind === "child") ? "child" : "adult",
      name: (v.name ?? null) ? String(v.name) : null,
      parentSurname: (v.parentSurname ?? "") ? String(v.parentSurname) : "",
      isVegetarian: v.isVegetarian === true
    };
  }
  return { kind: "adult", name: null, parentSurname: "", isVegetarian: false };
}

const TABLE_ORDER = [
  "ä¸»æ¡Œ","2-1","3-1","1-1","2-2","3-2","5-1",
  "1-2","2-3","3-3","5-2",
  "1-3","2-5","3-5","5-3"
];

// æ¡Œè™Ÿé…ç½®ï¼šä¸»æ¡Œç·¨è™Ÿ1(é‡‘è‰²)ï¼Œç”·æ–¹æ¡Œ(3-1,3-2,5-1,3-3,5-2)ç·¨è™Ÿ2-6(è—è‰²)ï¼Œå¥³æ–¹æ¡Œç·¨è™Ÿ7-15(ç²‰ç´…è‰²)
const TABLE_NUMBER_CONFIG = {
  "ä¸»æ¡Œ": { label: "1", color: "gold" },  // ä¸»æ¡Œ
  "3-1": { label: "2", color: "blue" },   // ç”·æ–¹æ¡Œ
  "3-2": { label: "3", color: "blue" },   // ç”·æ–¹æ¡Œ
  "5-1": { label: "4", color: "blue" },   // ç”·æ–¹æ¡Œ
  "3-3": { label: "5", color: "blue" },   // ç”·æ–¹æ¡Œ
  "5-2": { label: "6", color: "blue" },   // ç”·æ–¹æ¡Œ
  "2-1": { label: "7", color: "pink" },   // å¥³æ–¹æ¡Œ
  "1-1": { label: "8", color: "pink" },   // å¥³æ–¹æ¡Œ
  "2-2": { label: "9", color: "pink" },   // å¥³æ–¹æ¡Œ
  "1-2": { label: "10", color: "pink" },  // å¥³æ–¹æ¡Œ
  "2-3": { label: "11", color: "pink" },  // å¥³æ–¹æ¡Œ
  "1-3": { label: "12", color: "pink" },  // å¥³æ–¹æ¡Œ
  "2-5": { label: "13", color: "pink" },  // å¥³æ–¹æ¡Œ
  "3-5": { label: "14", color: "pink" },  // å¥³æ–¹æ¡Œ
  "5-3": { label: "15", color: "pink" }   // å¥³æ–¹æ¡Œ
};

const TABLE_NUMBER_COLORS = {
  blue: {
    background: "linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)",
    shadow: "0 4px 12px rgba(59, 130, 246, 0.4)"
  },
  pink: {
    background: "linear-gradient(135deg, #ec4899 0%, #db2777 100%)",
    shadow: "0 4px 12px rgba(236, 72, 153, 0.4)"
  },
  gold: {
    background: "linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%)",
    shadow: "0 4px 12px rgba(251, 191, 36, 0.4)"
  }
};

const DEFAULT_TABLE_GROUPS = {
  "ä¸»æ¡Œ": "å®¶äºº","2-1": "é¾å®¶","3-1": "æ“å®¶äºº","1-1": "è¦ªå‹","2-2": "æ²ˆå®¶",
  "3-2": "æ“æ‘¯å‹","5-1": "æ“äº¤å¤§","1-2": "æœ‹å‹","2-3": "æœ‹å‹","3-3": "æ“æ”¿å¤§",
  "5-2": "æ“åŒäº‹","1-3": "åŒå­¸","2-5": "åŒå­¸","3-5": "PK FITNESS","5-3": "è¯ç››ç…‡"
};

// é è¨­åº§ä½é…ç½®ï¼ˆå¾å‚™ä»½åŒ¯å…¥ï¼‰
const DEFAULT_STATE = {
  "version": 1,
  "tables": [
    {
      "name": "ä¸»æ¡Œ",
      "seats": [
        { "kind": "adult", "name": "å­æ“", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "ä½©ç’‡", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "æ¥Šä»ç†™", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "è‘‰ç‘æƒ ", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "è‘‰äºŒå§Š", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "è‘‰ä¸‰å§Š", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "è‘‰äºŒå§Šå¤«", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "é¾æƒ ç·", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "é¾ä¾ç²", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "æ²ˆæ–‡éƒ", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "æ²ˆæ–‡å®", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "æ¥Šå˜‰éŠ“", "parentSurname": "", "isVegetarian": false }
      ]
    },
    {
      "name": "2-1",
      "seats": [
        { "kind": "adult", "name": "æ¥Šå˜‰ç‰1", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "æ¥Šå˜‰ç‰2", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "æ¥Šå˜‰ç‰3", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "å¤§å§¨å©†1", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "å¤§å§¨å©†2", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "ä¸‰å§¨å©†1", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "ä¸‰å§¨å©†2", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": null, "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "è”¡æ­¦é›„2", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "é¾æƒ å¨Ÿ1", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "é¾æƒ å¨Ÿ2", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": null, "parentSurname": "", "isVegetarian": false }
      ]
    },
    {
      "name": "3-1",
      "seats": [
        { "kind": "adult", "name": "å³å­Ÿç‰¹", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "æ¥Šä¾å‡¡", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "å³å“æ¾„", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "å³å“å¸Œ", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "æ¥Šå­ç³", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "æ½˜é‡‘è–", "parentSurname": "", "isVegetarian": false },
        { "kind": "child", "name": "å°å®‰", "parentSurname": "æ½˜", "isVegetarian": false },
        { "kind": "adult", "name": "é»ƒæ•ç³", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "ææ‡‰æ™´", "parentSurname": "", "isVegetarian": false },
        { "kind": "child", "name": "é«˜å˜‰ä¼¶", "parentSurname": "é«˜", "isVegetarian": false },
        { "kind": "adult", "name": "é«˜å˜‰ä¼¶è€å…¬", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "é«˜å˜‰ä¼¶", "parentSurname": "", "isVegetarian": false }
      ]
    },
    {
      "name": "1-1",
      "seats": [
        { "kind": "adult", "name": "å§œä½³åˆ©1", "parentSurname": "" },
        { "kind": "adult", "name": "å§œä½³åˆ©2", "parentSurname": "" },
        { "kind": "adult", "name": "Tako2", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "Tako1", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "è”¡ä½³é ´1", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "è”¡ä½³é ´2", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "è”¡ä½³é ´3", "parentSurname": "", "isVegetarian": false },
        { "kind": "child", "name": "è”¡", "parentSurname": "è”¡", "isVegetarian": false },
        { "kind": "adult", "name": "æ²ˆéº—èŠ¬1", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "æ²ˆéº—èŠ¬2", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "æ²ˆéº—èŠ¬3", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": null, "parentSurname": "", "isVegetarian": false }
      ]
    },
    {
      "name": "2-2",
      "seats": [
        { "kind": "adult", "name": "æ²ˆæŸéœ–2", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "æ²ˆæŸéœ–3", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "æ²ˆæŸéœ–4", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "æ²ˆæŸéœ–5", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "æ²ˆæŸéœ–6", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "æ²ˆå¯¶æ˜¥", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "æ²ˆéº—èŠ¬4", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "å½­ç§€é›²2", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "å½­ç§€é›²3", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "å½­ç§€é›²4", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": null, "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": null, "parentSurname": "", "isVegetarian": false }
      ]
    },
    {
      "name": "3-2",
      "seats": [
        { "kind": "adult", "name": "ç¾…å¥•éˆ", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "æ—æ”¿å‚‘", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "é¦¬å½¥åˆ", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "åŠ‰æ˜•å®œ", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "éº’æ–‡", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "é»ƒç´”ä½³", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "å‘¨æ‰¿æ¯…", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "æ—æ‰¿å¨", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "é˜®ç«‹å‡±", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "é˜®å¥³å‹", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "å½­æ“æ˜", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": null, "parentSurname": "", "isVegetarian": false }
      ]
    },
    {
      "name": "5-1",
      "seats": [
        { "kind": "adult", "name": "é€£æ…¶", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "é€£æ…¶å¥³å‹", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "arbind", "parentSurname": "" },
        { "kind": "adult", "name": "arbindè€å©†", "parentSurname": "" },
        { "kind": "child", "name": "anika", "parentSurname": "arbind" },
        { "kind": "adult", "name": "è³´ä¼¯å®", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "ä¼¯å®å¥³å‹å§å®¹", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "é™³å¿—å‹", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "å¼µä½‘éŠ˜Mark", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "é™³å»ºå¿—", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "é™³å»ºå¿—è€å©†", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "å­«å˜‰å¦¤", "parentSurname": "", "isVegetarian": false }
      ]
    },
    {
      "name": "1-2",
      "seats": [
        { "kind": "adult", "name": null, "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "é»ƒæ˜æ…ˆ", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "æ¸¸ä½³è“‰", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "åŠ‰å½¥å®", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "ç‹æ˜ å–¬", "parentSurname": "", "isVegetarian": true },
        { "kind": "adult", "name": "é­é›¨ç¦ª", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "è‘‰æ—¥å‡±", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "å‘‚ä½©è‡»2", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "å‘‚ä½©è‡»1", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "æ—ç­±æ½”1", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "æ—ç­±æ½”2", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "æ—ç­±æ½”3", "parentSurname": "", "isVegetarian": false }
      ]
    },
    {
      "name": "2-3",
      "seats": [
        { "kind": "adult", "name": "ä¹¾åª½", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "è”¡å¦‚è1", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "è”¡å¦‚è2", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "æ¥Šå®œä¿®", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "é¾ç´¹è2", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "é¾ç´¹è1", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "è‹¥æ£»1", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "è‹¥æ£»2", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "ä¸Šæ…ˆ1", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "ä¸Šæ…ˆ2", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": null, "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": null, "parentSurname": "", "isVegetarian": false }
      ]
    },
    {
      "name": "3-3",
      "seats": [
        { "kind": "adult", "name": "é»ƒå»ºç¿”", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "å»ºç¿”å¥³å‹luna", "parentSurname": "" },
        { "kind": "adult", "name": "é™³å¥å…ƒ", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "åª›åª›", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "é¾ä½©å¦", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "æå®£æ¯…", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "é™³å† å®‡", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "æå†€", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "åŠ‰æœ‰å®¹", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "æœå¨å¾·", "parentSurname": "" },
        { "kind": "adult", "name": "å¨å¾·å¥³å‹", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": null, "parentSurname": "", "isVegetarian": false }
      ]
    },
    {
      "name": "5-2",
      "seats": [
        { "kind": "adult", "name": "æ¢ç¾©å‰eric", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "æ±ªé¡¯æ¬½tommy", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": null, "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "æ›¾ç´¹ç« sean", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "é™³å½¥å‘ˆjames", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "éƒ­æ³“æ¯…owen", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "è”¡ç§€é›²carol", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "é¡å‹¤æ™ºgary", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "å­Ÿæ½”", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "å®¶å®", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": null, "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": null, "parentSurname": "", "isVegetarian": false }
      ]
    },
    {
      "name": "1-3",
      "seats": [
        { "kind": "adult", "name": "é§±è²è‰", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "éƒ­å“²é ", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "é™³ç¾¿å»·", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "ç•¢æƒ çŠ", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "æ˜­å‹»", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "å¼µåº­ç‘œ", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "å»–å»¶è‹“", "parentSurname": "", "isVegetarian": false },
        { "kind": "child", "name": "çˆµ", "parentSurname": "é»ƒ", "isVegetarian": false },
        { "kind": "adult", "name": "é»ƒçˆµè±2", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "é»ƒçˆµè±1", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "æŸ¯å§µå®‰", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": null, "parentSurname": "", "isVegetarian": false }
      ]
    },
    {
      "name": "2-5",
      "seats": [
        { "kind": "adult", "name": "ç‹éº—æ™´1", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "ç‹éº—æ™´2", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "è³´å“è‡»1", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "è³´å“è‡»2", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "å§Šå§Š2", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "å§Šå§Š1", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "å”æé›¯1", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "é‚±å®œé”", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": null, "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": null, "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "é™³æ€¡éœ1", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "é™³æ€¡éœ2", "parentSurname": "", "isVegetarian": false }
      ]
    },
    {
      "name": "3-5",
      "seats": [
        { "kind": "adult", "name": "æŸ¯æ˜è¾°1", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "æŸ¯æ˜è¾°2", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "æŸ¯å®—å¦¤1", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "æŸ¯å®—å¦¤2", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "æŸ¯å®—å¦¤3", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "å½­æ˜€æ†", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "åŠ‰è‰¯è¼", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": null, "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "æ¸¸å­£ç‘¾1", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "æ¸¸å­£ç‘¾2", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "é™³å¤§ä¸­", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": null, "parentSurname": "", "isVegetarian": false }
      ]
    },
    {
      "name": "5-3",
      "seats": [
        { "kind": "adult", "name": "æŸ¯å»ºå®1", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "æŸ¯å»ºå®2", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "Alice", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "æ—å§Š", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "è€é—†", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "è€é—†å¨˜", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "å°æ³¢", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": null, "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": "é’èœ", "parentSurname": "", "isVegetarian": false },
        { "kind": "child", "name": "æŸ¯", "parentSurname": "æŸ¯", "isVegetarian": false },
        { "kind": "adult", "name": "æŸ¯å»ºå®3", "parentSurname": "", "isVegetarian": false },
        { "kind": "adult", "name": null, "parentSurname": "", "isVegetarian": false }
      ]
    }
  ],
  "pool": [],
  "tableGroups": {
    "ä¸»æ¡Œ": "å®¶äºº",
    "2-1": "é¾å®¶",
    "3-1": "æ“å®¶äºº",
    "1-1": "è¦ªå‹",
    "2-2": "æ²ˆå®¶",
    "3-2": "æ“æ‘¯å‹",
    "5-1": "æ“äº¤å¤§",
    "1-2": "æœ‹å‹",
    "2-3": "æœ‹å‹",
    "3-3": "æ“æ”¿å¤§",
    "5-2": "æ“åŒäº‹",
    "1-3": "åŒå­¸",
    "2-5": "åŒå­¸",
    "3-5": "PK FITNESS",
    "5-3": "è¯ç››ç…‡"
  }
};

const TABLE_LAYOUT = [
  // A3 è±å‘ä½ˆå±€ï¼Œä¸»æ¡Œæ­£ä¸­é–“ï¼Œ2ç³»åˆ—å’Œ3ç³»åˆ—åœ¨ä¸»æ¡Œå…©å´å°ç¨±
  // ç¬¬ä¸€æ’ï¼ˆy=15ï¼‰ï¼šä¸»æ¡Œæ­£ä¸­é–“
  { name: "ä¸»æ¡Œ", x: 50, y: 15 },
  // ç¬¬äºŒæ’ï¼ˆy=32ï¼‰ï¼š2-1(å¥³)å·¦å´å°ç¨±, 3-1(ç”·)å³å´å°ç¨±
  { name: "2-1", x: 38, y: 32 },
  { name: "3-1", x: 62, y: 32 },
  // ç¬¬ä¸‰æ’ï¼ˆy=50ï¼‰ï¼š1-1(å¥³)æœ€å·¦, 2-2(å¥³)å·¦å´å°ç¨±, 3-2(ç”·)å³å´å°ç¨±, 5-1(ç”·)æœ€å³
  { name: "1-1", x: 12, y: 50 },
  { name: "2-2", x: 38, y: 50 },
  { name: "3-2", x: 62, y: 50 },
  { name: "5-1", x: 88, y: 50 },
  // ç¬¬å››æ’ï¼ˆy=68ï¼‰ï¼š1-2(å¥³)æœ€å·¦, 2-3(å¥³)å·¦å´å°ç¨±, 3-3(ç”·)å³å´å°ç¨±, 5-2(ç”·)æœ€å³
  { name: "1-2", x: 12, y: 68 },
  { name: "2-3", x: 38, y: 68 },
  { name: "3-3", x: 62, y: 68 },
  { name: "5-2", x: 88, y: 68 },
  // ç¬¬äº”æ’ï¼ˆy=86ï¼‰ï¼š1-3(å¥³)æœ€å·¦, 2-5(å¥³)å·¦å´å°ç¨±, 3-5(å¥³)å³å´å°ç¨±, 5-3(å¥³)æœ€å³
  { name: "1-3", x: 12, y: 86 },
  { name: "2-5", x: 38, y: 86 },
  { name: "3-5", x: 62, y: 86 },
  { name: "5-3", x: 88, y: 86 },
];

const ZONES = [
  // å€åŸŸæ¨™ç¤ºï¼šå·¦å³å°ç¨±ï¼Œå±…ä¸­ç¾è§€
  { label: "ğŸ­ èˆå°", x: 50, y: 5, w: 35, h: 4.5 },
  { label: "ğŸ¸ èª¿é…’æ©Ÿ", x: 9, y: 6, w: 13, h: 8 },    // å·¦ä¸Šè§’
  { label: "ğŸµ éŸ³æ§", x: 91, y: 6, w: 13, h: 8 },    // å³ä¸Šè§’ï¼ˆå°ç¨±ï¼‰
  { label: "ğŸ’’ ç´…æ¯¯", x: 50, y: 56, w: 12, h: 72 },  // ä¸»æ¡Œå¾€ä¸‹å»¶ä¼¸è‡³æœ€å¾Œä¸€æ’èˆ‡å…¥å£ä¹‹é–“
  { label: "ğŸ“¸ èƒŒæ¿å€", x: 15, y: 97.5, w: 15, h: 2 },  // å·¦ä¸‹è§’
  { label: "ğŸšª å…¥å£", x: 38, y: 97.5, w: 12, h: 2 },  // å°æ‡‰2ç³»åˆ—ï¼ˆå¥³æ–¹ï¼‰
  { label: "ğŸšª å…¥å£", x: 62, y: 97.5, w: 12, h: 2 },  // å°æ‡‰3ç³»åˆ—ï¼ˆç”·æ–¹ï¼‰
  { label: "ğŸ½ï¸ æ¥å¾…æ¡Œ", x: 86, y: 97.5, w: 15, h: 2 },
];

/** =========================
 *  ç‹€æ…‹
 * ========================= */
let state = initializeState();
let selectedGuest = null;
let zoom = 1;

/** =========================
 *  åˆå§‹åŒ–ç‹€æ…‹ç®¡ç†
 * ========================= */
function initializeState() {
  const savedDefault = loadSavedDefault();
  if (savedDefault) {
    updateDefaultStateInfo(true);
    return normalizeState(savedDefault);
  }

  const currentState = loadState();
  if (currentState) {
    updateDefaultStateInfo(false);
    return currentState;
  }

  updateDefaultStateInfo(false);
  return normalizeState(DEFAULT_STATE);
}

function updateDefaultStateInfo(usingSavedDefault) {
  const infoEl = document.getElementById('defaultStateInfo');
  const textEl = document.getElementById('defaultStateText');

  if (usingSavedDefault) {
    infoEl.style.display = 'flex';
    textEl.textContent = 'âœ¨ ä½¿ç”¨ä¸­ï¼šå·²ä¿å­˜çš„é è¨­å€¼';
  } else {
    infoEl.style.display = 'none';
  }
}

/** =========================
 *  ä¿å­˜èˆ‡è¼‰å…¥é è¨­å€¼
 * ========================= */
function saveAsDefault() {
  if (!confirm("ğŸ’¾ ç¢ºå®šè¦å°‡ç•¶å‰çš„åº§ä½åˆ†é…ä¿å­˜ç‚ºé è¨­å€¼å—ï¼Ÿ\n\nä¸‹æ¬¡æ‰“é–‹æª”æ¡ˆæ™‚æœƒè‡ªå‹•è¼‰å…¥é€™å€‹é…ç½®ã€‚")) {
    return;
  }

  try {
    const dataToSave = {
      version: 1,
      tables: state.tables,
      pool: state.pool,
      tableGroups: state.tableGroups,
      savedAt: new Date().toISOString()
    };

    localStorage.setItem(SAVED_DEFAULT_KEY, JSON.stringify(dataToSave));
    updateDefaultStateInfo(true);
    showNotification("âœ… å·²ä¿å­˜ç‚ºé è¨­å€¼ï¼ä¸‹æ¬¡é–‹å•Ÿæœƒè‡ªå‹•è¼‰å…¥", "success");
  } catch(e) {
    console.error(e);
    showNotification("âŒ ä¿å­˜å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç€è¦½å™¨å„²å­˜ç©ºé–“", "danger");
  }
}

function loadSavedDefault() {
  try {
    const saved = localStorage.getItem(SAVED_DEFAULT_KEY);
    if (!saved) return null;
    return JSON.parse(saved);
  } catch(e) {
    console.error("Failed to load saved default:", e);
    return null;
  }
}

function restorePreset() {
  const savedPreset = loadSavedDefault();
  const hasPreset = savedPreset !== null;

  const message = hasPreset
    ? "ğŸ”„ ç¢ºå®šè¦æ¢å¾©åˆ°æ‚¨ä¿å­˜çš„é è¨­å€¼å—ï¼Ÿ\n\né€™å°‡é‡ç½®æ‰€æœ‰åº§ä½é…ç½®åˆ°ä¸Šæ¬¡ä¿å­˜çš„ç‹€æ…‹ã€‚"
    : "ğŸ”„ ç¢ºå®šè¦æ¢å¾©åˆ°ç³»çµ±åŸå§‹é è¨­å€¼å—ï¼Ÿ\n\né€™å°‡é‡ç½®æ‰€æœ‰åº§ä½é…ç½®åˆ°åˆå§‹ç‹€æ…‹ã€‚";

  if (!confirm(message)) {
    return;
  }

  try {
    localStorage.removeItem(STORAGE_KEY);

    if (hasPreset) {
      state = normalizeState(savedPreset);
      updateDefaultStateInfo(true);
      showNotification("âœ… å·²æ¢å¾©åˆ°æ‚¨ä¿å­˜çš„é è¨­å€¼", "success");
    } else {
      state = normalizeState(DEFAULT_STATE);
      updateDefaultStateInfo(false);
      showNotification("âœ… å·²æ¢å¾©åˆ°ç³»çµ±åŸå§‹é è¨­å€¼", "success");
    }

    selectedGuest = null;
    zoom = 1;

    saveState();
    renderAll();
    updateZoomUI();
    updateStats();
  } catch(e) {
    console.error(e);
    showNotification("âŒ æ¢å¾©å¤±æ•—", "danger");
  }
}

/** =========================
 *  Help Toggle
 * ========================= */
function toggleHelp() {
  const content = document.getElementById('helpContent');
  const arrow = document.getElementById('helpArrow');
  if (content.classList.contains('show')) {
    content.classList.remove('show');
    arrow.textContent = 'â–¼';
  } else {
    content.classList.add('show');
    arrow.textContent = 'â–²';
  }
}

/** =========================
 *  åˆå§‹åŒ–
 * ========================= */
document.getElementById("importBox").value = defaultGuestText;
renderAll();
updateZoomUI();
updateStats();

/** =========================
 *  UI ç¶å®š
 * ========================= */
document.getElementById("search").addEventListener("input", () => renderPool());

// Quick Actions
document.getElementById("importQuickBtn").addEventListener("click", () => {
  document.getElementById("importBox").scrollIntoView({ behavior: 'smooth' });
  document.getElementById("importBox").focus();
});

document.getElementById("exportQuickBtn").addEventListener("click", exportJson);
document.getElementById("clearAllBtn").addEventListener("click", clearAllSeats);
document.getElementById("exportPngQuickBtn").addEventListener("click", exportPlanAsImage);

document.getElementById("saveDefaultBtn").addEventListener("click", saveAsDefault);
document.getElementById("restorePresetBtn").addEventListener("click", restorePreset);
document.getElementById("clearPoolBtn").addEventListener("click", clearPool);

document.getElementById("importBtn").addEventListener("click", () => {
  const text = document.getElementById("importBox").value || "";
  const imported = parseGuestText(text);
  const assigned = new Set(getAllAssignedGuests());
  const merged = [];

  for (const name of imported) {
    if (!assigned.has(name)) merged.push(name);
  }

  const currentPool = state.pool.slice();
  for (const name of currentPool) {
    if (!assigned.has(name) && !merged.includes(name)) merged.push(name);
  }

  state.pool = uniqueList(merged);
  saveState();
  renderPool();
  updateStats();
  showNotification("âœ… åå–®å·²åˆä½µåˆ°æœªå®‰æ’è³“å®¢", "success");
});

function exportJson() {
  const data = JSON.stringify({ version: 1, ...state }, null, 2);
  try {
    navigator.clipboard.writeText(data);
    showNotification("âœ… å·²è¤‡è£½JSONåˆ°å‰ªè²¼ç°¿", "success");
  } catch(e) {
    prompt("è«‹æ‰‹å‹•è¤‡è£½ä¸‹é¢çš„å‚™ä»½è³‡æ–™ï¼š", data);
  }
}

document.getElementById("importJsonBtn").addEventListener("click", () => {
  const txt = prompt("ğŸ“¥ è²¼ä¸Šå®Œæ•´å‚™ä»½çš„JSONè³‡æ–™ï¼š");
  if (!txt) return;
  try {
    const obj = JSON.parse(txt);
    if (!obj.tables || !Array.isArray(obj.tables) || !Array.isArray(obj.pool)) throw new Error("bad");
    state = normalizeState(obj);
    selectedGuest = null;
    saveState();
    renderAll();
    updateStats();
    showNotification("âœ… JSONåŒ¯å…¥æˆåŠŸ", "success");
  } catch(e) {
    showNotification("âŒ JSONæ ¼å¼éŒ¯èª¤", "danger");
  }
});

document.getElementById("importLegacyBtn").addEventListener("click", () => {
  const txt = prompt("ğŸ“¥ è²¼ä¸ŠèˆŠæ ¼å¼ JSON (åŒ…å« table_no å’Œ seat_no æ¬„ä½)ï¼š");
  if (!txt) return;
  try {
    const raw = JSON.parse(txt);
    if (!raw.tables || !Array.isArray(raw.tables)) throw new Error("bad");

    const newTables = TABLE_ORDER.map((name, i) => ({
      name,
      seats: Array(seatCountByIndex(i)).fill(null).map(() => ({ kind:"adult", name:null, parentSurname:"" }))
    }));

    for (const t of raw.tables) {
      const tableNo = Number(t.table_no);
      if (!tableNo || tableNo < 1 || tableNo > 15) continue;
      const ti = tableNo - 1;
      const target = newTables[ti];
      const maxSeats = target.seats.length;

      if (Array.isArray(t.seats)) {
        for (const s of t.seats) {
          const sn = Number(s.seat_no);
          if (!sn || sn < 1 || sn > maxSeats) continue;
          const nm = String(s.name ?? "").trim();
          target.seats[sn - 1].name = (!nm || nm === "ç©ºä½") ? null : nm;
        }
      }
    }

    const seen = new Map();
    for (let ti=0; ti<newTables.length; ti++) {
      for (let si=0; si<newTables[ti].seats.length; si++) {
        const name = newTables[ti].seats[si].name;
        if (!name) continue;
        if (seen.has(name)) {
          const prev = seen.get(name);
          newTables[prev.ti].seats[prev.si].name = null;
        }
        seen.set(name, {ti,si});
      }
    }

    const assigned = new Set();
    newTables.forEach(t => t.seats.forEach(s => { if (s.name) assigned.add(s.name); }));

    state.tables = newTables;
    state.pool = state.pool.filter(n => !assigned.has(n));
    state.pool = uniqueList(state.pool);

    saveState();
    renderAll();
    updateStats();
    showNotification("âœ… èˆŠæ ¼å¼åŒ¯å…¥æˆåŠŸ", "success");
  } catch(e) {
    showNotification("âŒ åŒ¯å…¥å¤±æ•—ï¼Œè«‹æª¢æŸ¥æ ¼å¼", "danger");
  }
});

// Zoom
document.getElementById("zoomIn").addEventListener("click", () => setZoom(zoom + 0.1));
document.getElementById("zoomOut").addEventListener("click", () => setZoom(zoom - 0.1));
document.getElementById("zoomReset").addEventListener("click", () => setZoom(1));

document.getElementById("planViewport").addEventListener("wheel", (e) => {
  if (!e.ctrlKey) return;
  e.preventDefault();
  const delta = e.deltaY > 0 ? -0.05 : 0.05;
  setZoom(zoom + delta);
}, { passive:false });

function setZoom(z) {
  zoom = Math.max(0.5, Math.min(2, Number(z.toFixed(2))));
  updateZoomUI();
  renderPlan();
}

function updateZoomUI() {
  document.getElementById("zoomBadge").textContent = `${Math.round(zoom*100)}%`;
}

document.getElementById("exportPngBtn").addEventListener("click", exportPlanAsImage);

/** =========================
 *  çµ±è¨ˆè³‡è¨Šæ›´æ–°
 * ========================= */
function updateStats() {
  const totalSeats = state.tables.reduce((sum, t) => sum + t.seats.length, 0);
  const assignedCount = getAllAssignedGuests().length;
  const unassignedCount = state.pool.length;

  let childSeatsCount = 0;
  let vegetarianCount = 0;

  // ç”·æ–¹æ¡Œ: 2-6è™Ÿ (table names: 3-1, 3-2, 5-1, 3-3, 5-2) + ä¸»æ¡Œ6äºº
  // å¥³æ–¹æ¡Œ: 7-15è™Ÿ (table names: 2-1, 1-1, 2-2, 1-2, 2-3, 1-3, 2-5, 3-5, 5-3) + ä¸»æ¡Œ6äºº
  const groomTableNames = ["3-1", "3-2", "5-1", "3-3", "5-2"];
  const brideTableNames = ["2-1", "1-1", "2-2", "1-2", "2-3", "1-3", "2-5", "3-5", "5-3"];
  let groomSideCount = 0;
  let brideSideCount = 0;

  state.tables.forEach(t => {
    let tableGuestCount = 0;
    t.seats.forEach(s => {
      const seatObj = toSeatObj(s);
      if (seatObj.kind === "child" && seatObj.name) {
        childSeatsCount++;
      }
      if (seatObj.isVegetarian && seatObj.name) {
        vegetarianCount++;
      }
      if (seatObj.name) {
        tableGuestCount++;
      }
    });

    // è¨ˆç®—ç”·æ–¹å¥³æ–¹äººæ•¸
    if (groomTableNames.includes(t.name)) {
      groomSideCount += tableGuestCount;
    } else if (brideTableNames.includes(t.name)) {
      brideSideCount += tableGuestCount;
    } else if (t.name === "1") {
      // ä¸»æ¡Œ: å‰6å¸­ç”·æ–¹ï¼Œå¾Œ6å¸­å¥³æ–¹
      let seatIndex = 0;
      t.seats.forEach(s => {
        const seatObj = toSeatObj(s);
        if (seatObj.name) {
          if (seatIndex < 6) {
            groomSideCount++;
          } else {
            brideSideCount++;
          }
        }
        seatIndex++;
      });
    }
  });

  document.getElementById("totalSeats").textContent = totalSeats;
  document.getElementById("assignedCount").textContent = assignedCount;
  document.getElementById("unassignedCount").textContent = unassignedCount;
  document.getElementById("childSeatsCount").textContent = childSeatsCount;
  document.getElementById("vegetarianCount").textContent = vegetarianCount;
  document.getElementById("groomSideCount").textContent = groomSideCount;
  document.getElementById("brideSideCount").textContent = brideSideCount;
}

/** =========================
 *  Render
 * ========================= */
function renderAll() {
  renderPlan();
  renderPool();
  updateStats();
}

function renderPlan() {
  const plan = document.getElementById("plan");
  plan.innerHTML = "";
  plan.style.transform = `scale(${zoom})`;

  // zones
  for (const z of ZONES) {
    const d = document.createElement("div");
    d.className = "zone";
    d.style.left = z.x + "%";
    d.style.top = z.y + "%";
    d.style.width = z.w + "%";
    d.style.height = z.h + "%";
    d.style.transform = "translate(-50%, -50%)";
    d.textContent = z.label;
    plan.appendChild(d);
  }

  // è¨ˆç®—ç”·å¥³æ–¹äººæ•¸ (ç”¨æ–¼é¡¯ç¤ºåœ¨å¹³é¢åœ–)
  const groomTableNames = ["3-1", "3-2", "5-1", "3-3", "5-2"];
  const brideTableNames = ["2-1", "1-1", "2-2", "1-2", "2-3", "1-3", "2-5", "3-5", "5-3"];
  let groomCount = 0;
  let brideCount = 0;

  state.tables.forEach(t => {
    let tableGuestCount = 0;
    t.seats.forEach(s => {
      const seatObj = toSeatObj(s);
      if (seatObj.name) tableGuestCount++;
    });
    if (groomTableNames.includes(t.name)) {
      groomCount += tableGuestCount;
    } else if (brideTableNames.includes(t.name)) {
      brideCount += tableGuestCount;
    }
  });

  // åŠ ä¸Šä¸»æ¡Œå„ 6 äºº
  const groomTotal = groomCount + 6;
  const brideTotal = brideCount + 6;

  // ç”·æ–¹äººæ•¸æ¨™ç±¤ (å³å´)
  const groomLabel = document.createElement("div");
  groomLabel.className = "zone";
  groomLabel.style.cssText = `
    left: 95%; top: 30%; width: auto; height: auto;
    transform: translate(-50%, -50%);
    background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
    border: 2px solid #3b82f6;
    padding: 8px 12px;
    font-size: 12px;
    font-weight: 700;
    color: #1e40af;
    white-space: nowrap;
  `;
  groomLabel.innerHTML = `ğŸ‘” ç”·æ–¹<br>${groomTotal} äºº<br><span style="font-size:10px;font-weight:400;">(å«ä¸»æ¡Œ6äºº)</span>`;
  plan.appendChild(groomLabel);

  // å¥³æ–¹äººæ•¸æ¨™ç±¤ (å·¦å´)
  const brideLabel = document.createElement("div");
  brideLabel.className = "zone";
  brideLabel.style.cssText = `
    left: 5%; top: 30%; width: auto; height: auto;
    transform: translate(-50%, -50%);
    background: linear-gradient(135deg, #fce7f3 0%, #fbcfe8 100%);
    border: 2px solid #ec4899;
    padding: 8px 12px;
    font-size: 12px;
    font-weight: 700;
    color: #be185d;
    white-space: nowrap;
  `;
  brideLabel.innerHTML = `ğŸ‘° å¥³æ–¹<br>${brideTotal} äºº<br><span style="font-size:10px;font-weight:400;">(å«ä¸»æ¡Œ6äºº)</span>`;
  plan.appendChild(brideLabel);

  // ç‰ˆæœ¬è™Ÿæ¨™ç±¤ (å³ä¸‹è§’)
  const versionLabel = document.createElement("div");
  versionLabel.className = "zone";
  versionLabel.style.cssText = `
    left: 95%; top: 95%; width: auto; height: auto;
    transform: translate(-50%, -50%);
    background: #f3f4f6;
    border: 1px solid #d1d5db;
    padding: 4px 8px;
    font-size: 10px;
    font-weight: 500;
    color: #6b7280;
    white-space: nowrap;
  `;
  versionLabel.textContent = 'ç‰ˆæœ¬ __VERSION__';
  plan.appendChild(versionLabel);

  const tableSize = 340;
  const centerSize = 140;
  const ringFactor = 0.42;
  const angleOffset = 0;

  // tables
  state.tables.forEach((t, ti) => {
    const pos = TABLE_LAYOUT[ti] || {x:50,y:50,name:t.name};

    const wrap = document.createElement("div");
    wrap.className = "tableWrap";
    wrap.style.left = pos.x + "%";
    wrap.style.top = pos.y + "%";
    wrap.style.width = tableSize + "px";
    wrap.style.height = tableSize + "px";

    const table = document.createElement("div");
    table.className = "table";

    const center = document.createElement("div");
    center.className = "center";
    center.style.width = centerSize + "px";
    center.style.height = centerSize + "px";

    const filled = t.seats.filter(s => toSeatObj(s).name).length;
    const group = (state.tableGroups && state.tableGroups[t.name]) ? state.tableGroups[t.name] : "æœªåˆ†é¡";

    // å–å¾—æ¡Œè™Ÿé…ç½®
    const tableConfig = TABLE_NUMBER_CONFIG[t.name] || { label: "?", color: "gold" };
    const colorStyle = TABLE_NUMBER_COLORS[tableConfig.color];

    // å‰µå»ºæ¡Œè™Ÿæ¨™ç±¤ï¼ˆåœ¨æ¡Œå­ä¸Šæ–¹ï¼‰
    const tableNumber = document.createElement("div");
    tableNumber.className = "tableNumber";
    tableNumber.style.background = colorStyle.background;
    tableNumber.style.boxShadow = colorStyle.shadow;
    tableNumber.title = t.name;
    tableNumber.textContent = tableConfig.label;

    center.innerHTML = `
      <div class="groupTag" title="é»æˆ‘ä¿®æ”¹æ¡Œåˆ¥">${escapeHtml(group)}</div>
      <strong>${escapeHtml(t.name)}</strong>
      <div class="count">${filled}/${t.seats.length}</div>
    `;

    center.addEventListener("click", () => {
      const current = (state.tableGroups && state.tableGroups[t.name]) ? state.tableGroups[t.name] : "";
      const input = prompt(`ğŸ·ï¸ è¨­å®šã€Œ${t.name}ã€çš„æ¡Œåˆ¥é¡å‹\nä¾‹å¦‚ï¼šå®¶äººã€åŒäº‹ã€åŒå­¸ã€è¦ªå‹ç­‰`, current);
      if (input === null) return;
      const val = input.trim();
      if (!state.tableGroups) state.tableGroups = {};
      state.tableGroups[t.name] = val;
      saveState();
      renderPlan();
      showNotification(`âœ… ã€Œ${t.name}ã€æ¡Œåˆ¥å·²æ›´æ–°`, "success");
    });

    table.appendChild(tableNumber);
    table.appendChild(center);

    const n = t.seats.length;
    const cx = tableSize / 2, cy = tableSize / 2;
    const r = tableSize * ringFactor;

    for (let si=0; si<n; si++) {
      const seat = document.createElement("div");
      seat.className = "seat";
      seat.dataset.ti = ti;
      seat.dataset.si = si;

      const seatObj = toSeatObj(t.seats[si]);
      const guest = seatObj.name;
      const isChild = seatObj.kind === "child";
      const isVegetarian = seatObj.isVegetarian;

      const dim = isChild ? CHILD_SEAT : ADULT_SEAT;
      const seatHalfW = dim.w / 2;
      const seatHalfH = dim.h / 2;
      seat.style.width = `${dim.w}px`;
      seat.style.height = `${dim.h}px`;
      if (isChild) seat.classList.add("child");
      if (isVegetarian && guest) seat.classList.add("vegetarian");

      if (guest) {
        seat.classList.add("filled");
        if (isChild) {
          const ps = seatObj.parentSurname ? seatObj.parentSurname : "ğŸ‘¶";
          seat.textContent = `${guest}(${ps})`;
          const vegLabel = isVegetarian ? " ğŸ¥¬ç´ é£Ÿ" : "";
          seat.title = `${guest}ï¼ˆå®¶é•·å§“æ°ï¼š${ps}ï¼‰${vegLabel}\nå³éµåˆ‡æ›ç´ é£Ÿ`;
        } else {
          seat.textContent = guest;
          const vegLabel = isVegetarian ? " ğŸ¥¬ç´ é£Ÿ" : "";
          seat.title = `${guest}${vegLabel}\nå³éµåˆ‡æ›ç´ é£Ÿ`;
        }
      } else {
        seat.title = isChild ? "å…’ç«¥åº§æ¤…ï¼ˆç©ºï¼‰" : "ç©ºä½";
        seat.textContent = isChild ? "ğŸ‘¶" : "ç©º";
      }

      const angle = (360 / n) * si + angleOffset;
      const x = cx + r * Math.cos(angle * Math.PI / 180) - seatHalfW;
      const y = cy + r * Math.sin(angle * Math.PI / 180) - seatHalfH;
      seat.style.left = `${x}px`;
      seat.style.top = `${y}px`;

      // click seat
      seat.addEventListener("click", () => {
        const ti2 = Number(seat.dataset.ti);
        const si2 = Number(seat.dataset.si);
        const curObj = toSeatObj(state.tables[ti2].seats[si2]);
        const currentName = curObj.name;

        if (selectedGuest) {
          assignGuestToSeat(selectedGuest, ti2, si2);
          selectedGuest = null;
          renderPool();
          renderPlan();
          updateStats();
          return;
        }

        if (currentName) {
          if (confirm(`â“ è¦æŠŠã€Œ${currentName}ã€ç§»å›æœªå®‰æ’åå–®å—ï¼Ÿ`)) {
            unassignSeat(ti2, si2);
            renderPool();
            renderPlan();
            updateStats();
            showNotification(`âœ… ã€Œ${currentName}ã€å·²ç§»å›åå–®`, "success");
          }
          return;
        }

        const type = prompt("åº§æ¤…é¡å‹ï¼š\n1 = ä¸€èˆ¬åº§ä½\n2 = å…’ç«¥åº§æ¤…", curObj.kind === "child" ? "2" : "1");
        if (type === null) return;

        const kind = (type.trim() === "2") ? "child" : "adult";
        let parentSurname = curObj.parentSurname || "";
        if (kind === "child") {
          const ps = prompt("ğŸ‘¶ å®¶é•·å§“æ°ï¼ˆä¾‹å¦‚ï¼šç‹ã€é™³ã€æ—ç­‰ï¼‰", parentSurname);
          if (ps === null) return;
          parentSurname = ps.trim();
        }

        const input = prompt("âœï¸ è¼¸å…¥è³“å®¢å§“åï¼ˆå¯ç•™ç©ºï¼Œåªè¨­å®šåº§æ¤…é¡å‹ï¼‰");
        if (input === null) return;
        const name = input.trim() || null;

        state.tables[ti2].seats[si2] = { kind, name, parentSurname };
        saveState();
        renderPool();
        renderPlan();
        updateStats();
        showNotification("âœ… åº§ä½å·²æ›´æ–°", "success");
      });

      // drag drop
      seat.addEventListener("dragover", (e) => {
        e.preventDefault();
        seat.classList.add("dragover");
      });
      seat.addEventListener("dragleave", () => seat.classList.remove("dragover"));
      seat.addEventListener("drop", (e) => {
        e.preventDefault();
        seat.classList.remove("dragover");
        const name = e.dataTransfer.getData("text/plain");
        if (!name) return;
        const ti2 = Number(seat.dataset.ti);
        const si2 = Number(seat.dataset.si);
        assignGuestToSeat(name, ti2, si2);
        renderPool();
        renderPlan();
        updateStats();
      });

      // right click to toggle vegetarian
      seat.addEventListener("contextmenu", (e) => {
        e.preventDefault();
        const ti2 = Number(seat.dataset.ti);
        const si2 = Number(seat.dataset.si);
        const curObj = toSeatObj(state.tables[ti2].seats[si2]);

        if (!curObj.name) {
          showNotification("âš ï¸ è«‹å…ˆå®‰æ’è³“å®¢åˆ°æ­¤åº§ä½", "warning");
          return;
        }

        curObj.isVegetarian = !curObj.isVegetarian;
        state.tables[ti2].seats[si2] = curObj;
        saveState();
        renderPlan();
        updateStats();

        const status = curObj.isVegetarian ? "ğŸ¥¬ å·²æ¨™è¨˜ç‚ºç´ é£Ÿ" : "å–æ¶ˆç´ é£Ÿæ¨™è¨˜";
        showNotification(`âœ… ${curObj.name} ${status}`, "success");
      });

      table.appendChild(seat);
    }

    wrap.appendChild(table);
    plan.appendChild(wrap);
  });
}

function renderPool() {
  const poolEl = document.getElementById("pool");
  const q = (document.getElementById("search").value || "").trim().toLowerCase();
  poolEl.innerHTML = "";

  const filtered = state.pool
    .slice()
    .sort((a,b) => a.localeCompare(b, "zh-Hant"))
    .filter(n => !q || n.toLowerCase().includes(q));

  document.getElementById("poolCount").textContent =
    `ï¼ˆ${state.pool.length} ä½ï¼Œé¡¯ç¤º ${filtered.length}ï¼‰`;

  filtered.forEach(name => {
    const chip = document.createElement("div");
    chip.className = "chip";
    chip.draggable = true;
    chip.title = "æ‹–æ›³åˆ°åº§ä½ï¼Œæˆ–é»ä¸€ä¸‹å†é»åº§ä½";
    chip.innerHTML = `<b>${escapeHtml(name)}</b>`;

    chip.addEventListener("dragstart", (e) => {
      e.dataTransfer.setData("text/plain", name);
      e.dataTransfer.effectAllowed = "move";
    });

    chip.addEventListener("click", () => {
      if (selectedGuest === name) selectedGuest = null;
      else selectedGuest = name;

      [...poolEl.children].forEach(c => c.classList.remove("selected"));
      if (selectedGuest === name) {
        chip.classList.add("selected");
        showNotification(`ğŸ‘† å·²é¸æ“‡ã€Œ${name}ã€ï¼Œè«‹é»æ“Šåº§ä½å®‰æ’`, "info");
      }
    });

    poolEl.appendChild(chip);
  });
}

/** =========================
 *  è¼¸å‡ºæˆ PNG
 * ========================= */
async function exportPlanAsImage() {
  try {
    showNotification("ğŸ“¸ æ­£åœ¨ç”¢ç”Ÿåœ–ç‰‡ï¼Œè«‹ç¨å€™...", "info");
    const plan = document.getElementById("plan");
    const prevZoom = zoom;
    zoom = 1;
    updateZoomUI();
    renderPlan();

    await new Promise(r => setTimeout(r, 100));

    const clone = plan.cloneNode(true);
    clone.id = "planCloneForExport";
    clone.style.transform = "scale(1)";
    clone.style.position = "fixed";
    clone.style.left = "-10000px";
    clone.style.top = "0";
    clone.style.zIndex = "99999";
    document.body.appendChild(clone);

    const canvas = await html2canvas(clone, {
      backgroundColor: "#ffffff",
      scale: 2,
      useCORS: true
    });

    document.body.removeChild(clone);

    const dataUrl = canvas.toDataURL("image/png");
    const a = document.createElement("a");
    const ts = new Date().toISOString().slice(0,19).replace(/[:T]/g,"-");
    a.href = dataUrl;
    a.download = `seating-plan-${ts}.png`;
    a.click();

    zoom = prevZoom;
    updateZoomUI();
    renderPlan();
    showNotification("âœ… åœ–ç‰‡å·²ä¸‹è¼‰", "success");
  } catch(err) {
    console.error(err);
    showNotification("âŒ åœ–ç‰‡åŒ¯å‡ºå¤±æ•—", "danger");
  }
}

/** =========================
 *  æ ¸å¿ƒæ“ä½œ
 * ========================= */
function assignGuestToSeat(name, ti, si) {
  const t = state.tables[ti];
  const seatObj = toSeatObj(t.seats[si]);
  const current = seatObj.name;

  if (current) state.pool.push(current);

  const idx = state.pool.indexOf(name);
  if (idx >= 0) state.pool.splice(idx, 1);

  const pos = findGuestSeat(name);
  if (pos) state.tables[pos.ti].seats[pos.si].name = null;

  if (seatObj.kind === "child" && !seatObj.parentSurname) {
    const ps = prompt(`ğŸ‘¶ ã€Œ${name}ã€æ˜¯å…’ç«¥åº§æ¤…ï¼Œè«‹è¼¸å…¥å®¶é•·å§“æ°ï¼š`, "");
    if (ps !== null) seatObj.parentSurname = ps.trim();
  }

  seatObj.name = name;
  t.seats[si] = seatObj;

  state.pool = uniqueList(state.pool);
  saveState();
  showNotification(`âœ… ã€Œ${name}ã€å·²å®‰æ’åˆ°åº§ä½`, "success");
}

function unassignSeat(ti, si) {
  const t = state.tables[ti];
  const seatObj = toSeatObj(t.seats[si]);
  const name = seatObj.name;
  if (!name) return;

  seatObj.name = null;
  t.seats[si] = seatObj;

  state.pool.push(name);
  state.pool = uniqueList(state.pool);
  saveState();
}

function findGuestSeat(name) {
  for (let ti=0; ti<state.tables.length; ti++) {
    const seats = state.tables[ti].seats;
    for (let si=0; si<seats.length; si++) {
      if (toSeatObj(seats[si]).name === name) return {ti, si};
    }
  }
  return null;
}

function getAllAssignedGuests() {
  const out = [];
  state.tables.forEach(t => t.seats.forEach(s => {
    const nm = toSeatObj(s).name;
    if (nm) out.push(nm);
  }));
  return out;
}

function clearAllSeats() {
  if (!confirm("âš ï¸ ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰åº§ä½å—ï¼Ÿï¼ˆè³“å®¢æœƒç§»å›æœªå®‰æ’åå–®ï¼‰")) return;

  state.tables.forEach(t => {
    t.seats.forEach((s, si) => {
      const seatObj = toSeatObj(s);
      if (seatObj.name) {
        state.pool.push(seatObj.name);
        seatObj.name = null;
        t.seats[si] = seatObj;
      }
    });
  });

  state.pool = uniqueList(state.pool);
  saveState();
  renderAll();
  showNotification("âœ… æ‰€æœ‰åº§ä½å·²æ¸…ç©º", "success");
}

function clearPool() {
  if (!confirm("âš ï¸ ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰æœªå®‰æ’è³“å®¢å—ï¼Ÿ\n\né€™ä¸æœƒå½±éŸ¿å·²å®‰æ’åˆ°åº§ä½çš„è³“å®¢ã€‚")) return;

  state.pool = [];
  saveState();
  renderPool();
  updateStats();
  showNotification("âœ… æœªå®‰æ’è³“å®¢å·²æ¸…ç©º", "success");
}

/** =========================
 *  è§£æåå–®
 * ========================= */
function parseGuestText(text) {
  const raw = (text||"")
    .replace(/\r/g, "\n")
    .replace(/[â€”â€“]+/g, "\n")
    .replace(/-{3,}/g, "\n")
    .replace(/&&/g, "\n");

  const parts = raw
    .split("\n")
    .map(s => s.trim())
    .filter(Boolean)
    .flatMap(line => line.split(/\s{2,}|\t+/).map(x => x.trim()).filter(Boolean));

  const cleaned = parts
    .map(s => s.replace(/\u00A0/g," ").trim())
    .filter(s => s && s !== "â€”" && s !== "-");

  return uniqueList(cleaned);
}

function uniqueList(arr) {
  const seen = new Set();
  const out = [];
  for (const x of arr) {
    if (!seen.has(x)) {
      seen.add(x);
      out.push(x);
    }
  }
  return out;
}

/** =========================
 *  å»ºç«‹/ä¿å­˜
 * ========================= */
function makeFreshState() {
  return normalizeState(DEFAULT_STATE);
}

function normalizeState(obj) {
  const tables = [];
  for (let i=0; i<TABLE_LAYOUT.length; i++) {
    const wantName = TABLE_LAYOUT[i].name;
    const old = (obj.tables && obj.tables[i]) ? obj.tables[i] : null;
    const want = seatCountByIndex(i);

    const rawSeats = (old && Array.isArray(old.seats)) ? old.seats.slice(0, want) : [];
    while (rawSeats.length < want) rawSeats.push(null);

    const seats = rawSeats.map(toSeatObj);
    tables.push({ name: wantName, seats });
  }

  const tableGroups = {};
  const incoming = (obj.tableGroups && typeof obj.tableGroups === "object") ? obj.tableGroups : {};
  for (const name of TABLE_ORDER) {
    tableGroups[name] = (incoming[name] ?? DEFAULT_TABLE_GROUPS[name] ?? "");
  }

  return {
    tables,
    pool: Array.isArray(obj.pool) ? obj.pool : [],
    tableGroups
  };
}

function saveState() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
}

function loadState() {
  try {
    const s = localStorage.getItem(STORAGE_KEY);
    if (!s) return null;
    const obj = JSON.parse(s);
    return normalizeState(obj);
  } catch(e) {
    return null;
  }
}

/** =========================
 *  é€šçŸ¥ç³»çµ±
 * ========================= */
function showNotification(message, type = "info") {
  const colors = {
    success: "#10b981",
    danger: "#ef4444",
    warning: "#f59e0b",
    info: "#3b82f6"
  };

  const div = document.createElement("div");
  div.textContent = message;
  div.style.cssText = `
    position: fixed;
    top: 80px;
    right: 24px;
    background: ${colors[type] || colors.info};
    color: white;
    padding: 16px 24px;
    border-radius: 12px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.3);
    z-index: 10000;
    font-weight: 600;
    font-size: 14px;
    animation: slideIn 0.3s ease;
  `;

  document.body.appendChild(div);

  setTimeout(() => {
    div.style.animation = "slideOut 0.3s ease";
    setTimeout(() => div.remove(), 300);
  }, 3000);
}

// CSS Animations
const style = document.createElement("style");
style.textContent = `
  @keyframes slideIn {
    from {
      transform: translateX(400px);
      opacity: 0;
    }
    to {
      transform: translateX(0);
      opacity: 1;
    }
  }
  @keyframes slideOut {
    from {
      transform: translateX(0);
      opacity: 1;
    }
    to {
      transform: translateX(400px);
      opacity: 0;
    }
  }
`;
document.head.appendChild(style);

/** =========================
 *  å°å·¥å…·
 * ========================= */
function escapeHtml(str) {
  return String(str)
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}

/** =========================
 *  å¸¶ä½è¡¨æ ¼ç”Ÿæˆ
 * ========================= */
// æŒ‰éˆ•äº‹ä»¶ç¶å®š
document.getElementById("exportGroomGuideBtn").addEventListener("click", () => generateSeatingGuide("groom"));
document.getElementById("exportBrideGuideBtn").addEventListener("click", () => generateSeatingGuide("bride"));
document.getElementById("showTableNamesBtn").addEventListener("click", showTableNames);
document.getElementById("showFloorPlanBtn").addEventListener("click", showFloorPlan);

function generateSeatingGuide(side) {
  // å®šç¾©ç”·æ–¹æ¡Œå’Œå¥³æ–¹æ¡Œ
  const groomTables = ["3-1", "3-2", "5-1", "3-3", "5-2"];  // è—è‰² 2-6è™Ÿæ¡Œ
  const brideTables = ["2-1", "1-1", "2-2", "1-2", "2-3", "1-3", "2-5", "3-5", "5-3"];  // ç²‰è‰² 7-15è™Ÿæ¡Œ

  const selectedTables = side === "groom" ? groomTables : brideTables;
  const title = side === "groom" ? "ğŸ‘” ç”·æ–¹å¸¶ä½è¡¨" : "ğŸ‘° å¥³æ–¹å¸¶ä½è¡¨";
  const bgColor = side === "groom" ? "#dbeafe" : "#fce7f3";

  // æ”¶é›†è¡¨æ ¼æ•¸æ“š
  const tableData = [];
  let totalGuests = 0;
  let totalChildren = 0;
  let totalVegetarian = 0;

  selectedTables.forEach(tableName => {
    const tableConfig = TABLE_NUMBER_CONFIG[tableName];
    const tableIndex = state.tables.findIndex(t => t.name === tableName);

    if (tableIndex === -1) return;

    const table = state.tables[tableIndex];
    const tableGroup = (state.tableGroups && state.tableGroups[tableName]) ? state.tableGroups[tableName] : "æœªåˆ†é¡";
    const guests = [];
    let childCount = 0;
    let vegCount = 0;

    table.seats.forEach(seat => {
      const seatObj = toSeatObj(seat);
      if (seatObj.name) {
        let guestInfo = seatObj.name;
        if (seatObj.kind === "child") {
          guestInfo += ` (å…’ç«¥${seatObj.parentSurname ? 'ãƒ»' + seatObj.parentSurname : ''})`;
          childCount++;
          totalChildren++;
        }
        if (seatObj.isVegetarian) {
          guestInfo += " ğŸ¥¬";
          vegCount++;
          totalVegetarian++;
        }
        guests.push(guestInfo);
        totalGuests++;
      }
    });

    tableData.push({
      tableNumber: tableConfig.label,
      tableName: tableName,
      tableGroup: tableGroup,
      guests: guests,
      guestCount: guests.length,
      childCount: childCount,
      vegCount: vegCount
    });
  });

  // æŒ‰æ¡Œè™Ÿæ’åº
  tableData.sort((a, b) => Number(a.tableNumber) - Number(b.tableNumber));

  // ç”ŸæˆHTML
  let html = `
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>${title}</title>
<style>
  @media print {
    @page {
      size: A4 portrait;
      margin: 10mm;
    }
    body {
      print-color-adjust: exact;
      -webkit-print-color-adjust: exact;
    }
    .header {
      margin-bottom: 8px;
      padding: 8px;
    }
    .table-card {
      margin-bottom: 8px;
      padding: 8px;
    }
  }

  body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Noto Sans TC", sans-serif;
    padding: 12px;
    background: #f9fafb;
  }

  .header {
    text-align: center;
    margin-bottom: 12px;
    padding: 12px;
    background: ${bgColor};
    border-radius: 8px;
    border: 2px solid ${side === "groom" ? "#3b82f6" : "#ec4899"};
  }

  .header h1 {
    margin: 0;
    font-size: 20px;
    color: ${side === "groom" ? "#1e40af" : "#9f1239"};
  }

  .header p {
    margin: 6px 0 0 0;
    font-size: 12px;
    color: #6b7280;
  }

  .table-card {
    background: white;
    border: 1px solid #d1d5db;
    border-radius: 8px;
    padding: 10px;
    margin-bottom: 10px;
    break-inside: avoid;
  }

  .table-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
    padding-bottom: 8px;
    border-bottom: 1px solid #e5e7eb;
  }

  .table-info {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .table-number {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: ${side === "groom" ? "linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)" : "linear-gradient(135deg, #ec4899 0%, #db2777 100%)"};
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
    font-weight: 900;
    flex-shrink: 0;
  }

  .table-name {
    font-size: 15px;
    font-weight: 700;
    color: #111827;
  }

  .guest-count {
    font-size: 12px;
    color: #6b7280;
    background: #f3f4f6;
    padding: 4px 10px;
    border-radius: 999px;
    font-weight: 600;
  }

  .guest-list {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 6px;
  }

  .guest-item {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 6px;
    background: #f9fafb;
    border: 1px solid #e5e7eb;
    border-radius: 4px;
    font-size: 13px;
  }

  .checkbox {
    width: 16px;
    height: 16px;
    border: 2px solid #d1d5db;
    border-radius: 3px;
    flex-shrink: 0;
  }

  .guest-name {
    flex: 1;
    font-weight: 600;
    color: #374151;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .empty-note {
    text-align: center;
    padding: 15px;
    color: #9ca3af;
    font-style: italic;
    font-size: 12px;
  }

  .print-btn {
    position: fixed;
    bottom: 30px;
    right: 30px;
    padding: 15px 30px;
    background: ${side === "groom" ? "#3b82f6" : "#ec4899"};
    color: white;
    border: none;
    border-radius: 12px;
    font-size: 16px;
    font-weight: 700;
    cursor: pointer;
    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    z-index: 1000;
  }

  .print-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 12px 30px rgba(0,0,0,0.25);
  }

  @media print {
    .print-btn {
      display: none;
    }
  }
</style>
    <style>
        .back-to-home {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, #d4145a 0%, #ff5a8a 100%);
            color: white;
            padding: 12px 24px;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 600;
            font-size: 14px;
            box-shadow: 0 4px 16px rgba(212, 20, 90, 0.3);
            transition: all 0.3s ease;
            z-index: 9999;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .back-to-home:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(212, 20, 90, 0.4);
        }
        @media print {
            .back-to-home { display: none; }
        }
        @media (max-width: 768px) {
            .back-to-home {
                bottom: 16px;
                right: 16px;
                padding: 10px 20px;
                font-size: 13px;
            }
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-to-home">
        <span>ğŸ </span>
        <span>è¿”å›é¦–é </span>
    </a>
  <div class="header">
    <h1>${title}</h1>
    <p>ç¸½å…± ${tableData.length} æ¡Œ Â· ${totalGuests} ä½è³“å®¢ Â· ğŸ‘¶ ${totalChildren} ä½å…’ç«¥ Â· ğŸ¥¬ ${totalVegetarian} ä½ç´ é£Ÿ</p>
  </div>
`;

  tableData.forEach(table => {
    html += `
  <div class="table-card">
    <div class="table-header">
      <div class="table-info">
        <div class="table-number">${table.tableNumber}</div>
        <div>
          <div class="table-name">${table.tableName}</div>
          <div style="font-size: 11px; color: #6b7280; margin-top: 2px;">ğŸ“‹ ${escapeHtml(table.tableGroup)}</div>
        </div>
      </div>
      <div class="guest-count">${table.guestCount} ä½${table.childCount > 0 ? ' Â· ğŸ‘¶' + table.childCount : ''}${table.vegCount > 0 ? ' Â· ğŸ¥¬' + table.vegCount : ''}</div>
    </div>
    <div class="guest-list">`;

    if (table.guests.length > 0) {
      table.guests.forEach(guest => {
        html += `
      <div class="guest-item">
        <div class="checkbox"></div>
        <div class="guest-name">${escapeHtml(guest)}</div>
      </div>`;
      });
    } else {
      html += `
      <div class="empty-note">æ­¤æ¡Œå°šç„¡å®‰æ’è³“å®¢</div>`;
    }

    html += `
    </div>
  </div>`;
  });

  html += `
  <button class="print-btn" onclick="window.print()">ğŸ–¨ï¸ åˆ—å°è¡¨æ ¼</button>
</body>
</html>`;

  // åœ¨æ–°è¦–çª—æ‰“é–‹
  const newWindow = window.open('', '_blank');
  if (newWindow) {
    newWindow.document.write(html);
    newWindow.document.close();
    showNotification(`âœ… ${title}å·²ç”Ÿæˆ`, "success");
  } else {
    showNotification("âŒ è«‹å…è¨±å½ˆå‡ºè¦–çª—", "danger");
  }
}

/** =========================
 *  æ¡Œåå°æ‡‰è¡¨
 * ========================= */
function showTableNames() {
  // æ„›æƒ…æ•…äº‹æ¡Œå
  const loveStoryNames = {
    "1": "1é¡†åˆå¿ƒå¾ç›¸è¦‹çš„é¤˜ç”Ÿ",
    "2": "æ–°äººäº¤å¾€ç¬¬2å¹´ä¸€èµ·åˆ°æ±äº¬è¿ªå£«å°¼",
    "3": "æ–°éƒåœ¨äº¤å¾€ç¬¬3å¹´æ±‚å©š",
    "4": "æƒ³å¸¶ä½ èµ°é4å­£ç´¯ç©ç”œèœœå›æ†¶",
    "5": "å…©ä½æ–°äººå¹³å¸¸ç·´è·‘æœ€å¿«æ˜¯5åˆ†é€Ÿ",
    "6": "æ–°äººä¸€èµ·è·‘é6å ´é¦¬æ‹‰æ¾",
    "7": "è«‹7å¾…ç”œèœœé¢¨æš´ æ–°äººæ­£åœ¨åŠ è¼‰ä¸­",
    "8": "æ„›æ˜¯çå¯¶ 8æ–¹ç¥ç¦ æ°¸ä¼´èº«é‚Š",
    "9": "ç°½ä¸‹æ„›æƒ…æ°¸9æœ‰æ•ˆ ä¹…ä¹…å¿ƒå‹•",
    "10": "10è¶³åæ„› è¢«å …å®šé¸æ“‡å°±æ˜¯æœ€æµªæ¼«çš„äº‹",
    "11": "æ°‘åœ‹111 æ­£å¼äº¤å¾€ ä¸¦è‚©ç›¸ä¼´",
    "12": "æ–°å¨˜çš„ç”Ÿæ—¥åœ¨12æœˆ",
    "13": "å¿ƒè·³çš„é »ç‡å‰›å¥½æ˜¯1314çš„ç¯€å¥",
    "14": "å©šç¦®é€™å¤©æ˜¯äº¤å¾€ç¬¬1314å¤©",
    "15": "æ–°äººåœ¨115å¹´çµå©š"
  };

  // æ”¶é›†æ‰€æœ‰æ¡Œå­ä¿¡æ¯
  const tableInfo = [];
  for (let i = 0; i < TABLE_ORDER.length; i++) {
    const tableName = TABLE_ORDER[i];
    const config = TABLE_NUMBER_CONFIG[tableName];
    const tableGroup = (state.tableGroups && state.tableGroups[tableName]) ? state.tableGroups[tableName] : "æœªåˆ†é¡";
    const tableNumber = config.label;
    const loveStory = loveStoryNames[tableNumber] || "";

    tableInfo.push({
      number: tableNumber,
      tableName: tableName,
      tableGroup: tableGroup,
      loveStory: loveStory,
      color: config.color
    });
  }

  // æŒ‰æ¡Œè™Ÿæ’åº
  tableInfo.sort((a, b) => Number(a.number) - Number(b.number));

  // ç”ŸæˆHTML
  let html = `
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>ğŸ’• æ¡Œåå°æ‡‰è¡¨</title>
<style>
  @media print {
    @page { size: A4 portrait; margin: 15mm; }
    body { print-color-adjust: exact; -webkit-print-color-adjust: exact; }
  }
  body {
    font-family: -apple-system, "Noto Sans TC", sans-serif;
    padding: 20px;
    background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
    min-height: 100vh;
  }
  .header {
    text-align: center;
    margin-bottom: 30px;
    padding: 30px;
    background: white;
    border-radius: 16px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.1);
  }
  .header h1 {
    margin: 0 0 10px 0;
    font-size: 32px;
    background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }
  .table-list { display: grid; gap: 16px; }
  .table-row {
    background: white;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    display: grid;
    grid-template-columns: 80px 120px 1fr;
    gap: 20px;
    align-items: center;
    break-inside: avoid;
  }
  .table-number-big {
    width: 70px; height: 70px; border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 32px; font-weight: 900; color: white;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  }
  .table-number-big.gold { background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); }
  .table-number-big.blue { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); }
  .table-number-big.pink { background: linear-gradient(135deg, #ec4899 0%, #db2777 100%); }
  .table-details { display: flex; flex-direction: column; gap: 6px; }
  .table-pos { font-size: 18px; font-weight: 700; color: #111827; }
  .table-group { font-size: 14px; color: #6b7280; }
  .love-story { font-size: 16px; color: #92400e; font-weight: 600; line-height: 1.5; }
  .print-btn {
    position: fixed; bottom: 30px; right: 30px;
    padding: 15px 30px;
    background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
    color: white; border: none; border-radius: 12px;
    font-size: 16px; font-weight: 700; cursor: pointer;
    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
  }
  @media print { .print-btn { display: none; } }
</style>
    <style>
        .back-to-home {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, #d4145a 0%, #ff5a8a 100%);
            color: white;
            padding: 12px 24px;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 600;
            font-size: 14px;
            box-shadow: 0 4px 16px rgba(212, 20, 90, 0.3);
            transition: all 0.3s ease;
            z-index: 9999;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .back-to-home:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(212, 20, 90, 0.4);
        }
        @media print {
            .back-to-home { display: none; }
        }
        @media (max-width: 768px) {
            .back-to-home {
                bottom: 16px;
                right: 16px;
                padding: 10px 20px;
                font-size: 13px;
            }
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-to-home">
        <span>ğŸ </span>
        <span>è¿”å›é¦–é </span>
    </a>
  <div class="header">
    <h1>ğŸ’• å©šç¦®æ¡Œåå°æ‡‰è¡¨</h1>
    <p>å¤§ç›´å…¸è¯é–£æ¨“ Â· 15æ¡Œ</p>
  </div>
  <div class="table-list">`;

  tableInfo.forEach(table => {
    html += `
    <div class="table-row">
      <div class="table-number-big ${table.color}">${table.number}</div>
      <div class="table-details">
        <div class="table-pos">${escapeHtml(table.tableName)}</div>
        <div class="table-group">ğŸ“‹ ${escapeHtml(table.tableGroup)}</div>
      </div>
      <div class="love-story">${escapeHtml(table.loveStory)}</div>
    </div>`;
  });

  html += `
  </div>
  <button class="print-btn" onclick="window.print()">ğŸ–¨ï¸ åˆ—å°è¡¨æ ¼</button>
</body>
</html>`;

  const newWindow = window.open('', '_blank');
  if (newWindow) {
    newWindow.document.write(html);
    newWindow.document.close();
    showNotification("âœ… æ¡Œåå°æ‡‰è¡¨å·²ç”Ÿæˆ", "success");
  } else {
    showNotification("âŒ è«‹å…è¨±å½ˆå‡ºè¦–çª—", "danger");
  }
}

/** =========================
 *  å ´åœ°å¹³é¢åœ–
 * ========================= */
function showFloorPlan() {
  const html = `
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>ğŸ›ï¸ å¤§ç›´å…¸è¯é–£æ¨“15æ¡Œåœ–</title>
<style>
  @media print {
    @page { size: A3 portrait; margin: 5mm; }
    body { print-color-adjust: exact; -webkit-print-color-adjust: exact; }
    .print-btn { display: none; }
  }
  body {
    font-family: "Noto Sans TC", sans-serif;
    margin: 0;
    padding: 20px;
    background: #f3f4f6;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }
  .header {
    text-align: center;
    margin-bottom: 20px;
  }
  .header h1 {
    font-size: 28px;
    color: #111827;
    margin: 0 0 10px 0;
  }
  .image-container {
    max-width: 100%;
    background: white;
    border-radius: 16px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.1);
    padding: 20px;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  .floor-plan-img {
    max-width: 100%;
    height: auto;
    border-radius: 8px;
  }
  .print-btn {
    position: fixed;
    bottom: 30px;
    right: 30px;
    padding: 15px 30px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    border-radius: 12px;
    font-size: 16px;
    font-weight: 700;
    cursor: pointer;
    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
  }
  .print-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 12px 30px rgba(0,0,0,0.25);
  }
</style>
    <style>
        .back-to-home {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, #d4145a 0%, #ff5a8a 100%);
            color: white;
            padding: 12px 24px;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 600;
            font-size: 14px;
            box-shadow: 0 4px 16px rgba(212, 20, 90, 0.3);
            transition: all 0.3s ease;
            z-index: 9999;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .back-to-home:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(212, 20, 90, 0.4);
        }
        @media print {
            .back-to-home { display: none; }
        }
        @media (max-width: 768px) {
            .back-to-home {
                bottom: 16px;
                right: 16px;
                padding: 10px 20px;
                font-size: 13px;
            }
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-to-home">
        <span>ğŸ </span>
        <span>è¿”å›é¦–é </span>
    </a>
  <div class="header">
    <h1>ğŸ›ï¸ å¤§ç›´å…¸è¯é–£æ¨“å ´åœ°é…ç½®åœ–</h1>
    <p>15æ¡Œå¹³é¢åœ– Â· A3å°ºå¯¸</p>
  </div>
  <div class="image-container">
    <img src="assets/images/å¤§ç›´å…¸è¯é–£æ¨“15æ¡Œåœ–.jpg" alt="å¤§ç›´å…¸è¯é–£æ¨“15æ¡Œåœ–" class="floor-plan-img">
  </div>
  <button class="print-btn" onclick="window.print()">ğŸ–¨ï¸ åˆ—å°å¹³é¢åœ–</button>
</body>
</html>`;

  const newWindow = window.open('', '_blank');
  if (newWindow) {
    newWindow.document.write(html);
    newWindow.document.close();
    showNotification("âœ… å ´åœ°å¹³é¢åœ–å·²ç”Ÿæˆ", "success");
  } else {
    showNotification("âŒ è«‹å…è¨±å½ˆå‡ºè¦–çª—", "danger");
  }
}
</script>

<div style="margin-top: 40px; padding-top: 20px; border-top: 2px solid #e9ecef; text-align: center; color: #6c757d; font-size: 13px;">
    <div style="margin-bottom: 8px;">Made with â¤ï¸ for å­æ“ & ä½©ç’‡'s Special Day</div>
    <div style="display: inline-block; background: #e9ecef; padding: 4px 12px; border-radius: 12px; font-weight: 600;">
        ç‰ˆæœ¬ï¼š<span id="site-version">__VERSION__</span>
    </div>
</div>

</body>
</html>
